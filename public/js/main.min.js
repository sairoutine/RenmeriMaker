!function(){function t(e,n,r){function i(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n||t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}return t}()({1:[function(t,e,n){"use strict";var r=t("../hakurei").util,i={};i.images=r.assign(t("./chara"),t("./bg")),i.sounds={},i.bgms=t("./bgm"),e.exports=i},{"../hakurei":6,"./bg":2,"./bgm":3,"./chara":4}],2:[function(t,e,n){"use strict";e.exports={nc138477:{name:"森の中",path:"/image/bg/nc138477.jpg"},nc14162:{name:"夜の海岸",path:"/image/bg/nc14162.jpg"},nc4527:{name:"道路",path:"/image/bg/nc4527.jpg"},nc68222:{name:"校門前",path:"/image/bg/nc68222.jpg"},nc72006:{name:"夜の森林",path:"/image/bg/nc72006.jpg"},nc7951:{name:"学内",path:"/image/bg/nc7951.jpg"},nc95621:{name:"お店",path:"/image/bg/nc95621.jpg"}}},{}],3:[function(t,e,n){"use strict";e.exports={nc13447:{name:"しんみり",path:"/bgm/nc13447.mp3",loopStart:0,volume:1},nc20349:{name:"やる気がない",path:"/bgm/nc20349.mp3",loopStart:0,volume:1},nc22928:{name:"ナチュラル",path:"/bgm/nc22928.mp3",loopStart:0,volume:1},nc32144:{name:"おしゃれ",path:"/bgm/nc32144.m4a",loopStart:0,volume:1},nc38444:{name:"ほのぼの",path:"/bgm/nc38444.mp3",loopStart:0,volume:1},nc41740:{name:"キラキラ",path:"/bgm/nc41740.mp3",loopStart:0,volume:1},nc76949:{name:"和風",path:"/bgm/nc76949.mp3",loopStart:0,volume:1}}},{}],4:[function(t,e,n){"use strict";e.exports={renko_normal:"/image/renko/normal1.png",renko_smile:"/image/renko/smile1.png",renko_cry:"/image/renko/cry1.png",renko_surprised:"/image/renko/surprised1.png",renko_angry:"/image/renko/angry1.png",merry_normal:"/image/merry/normal1.png",merry_smile:"/image/merry/smile.png",merry_cry:"/image/merry/cry1.png",merry_surprised:"/image/merry/surprised1.png",merry_angry:"/image/merry/angry1.png"}},{}],5:[function(t,e,n){"use strict";var r=t("./hakurei").core,i=t("./hakurei").util,o=t("./scene/talk"),a=t("./scene/loading"),s=t("./scene/end"),u=function(t,e){r.apply(this,arguments),this.serif=null,this.scene_manager.addScene("loading",new a(this)),this.scene_manager.addScene("talk",new o(this)),this.scene_manager.addScene("end",new s(this))};i.inherit(u,r),u.prototype.setSerif=function(t){this.serif=t},u.prototype.init=function(){this.scene_manager.changeScene("loading")},u.prototype.reload=function(){this.scene_manager.changeScene("talk")},e.exports=u},{"./hakurei":6,"./scene/end":58,"./scene/loading":59,"./scene/talk":60}],6:[function(t,e,n){"use strict";e.exports=t("./hakureijs/index")},{"./hakureijs/index":13}],7:[function(t,e,n){"use strict";var r=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this._reserved_play_sound_name_map={},this.audio_context=null,window&&window.AudioContext&&(this.audio_context=new window.AudioContext,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode),this._audio_source_map={}};r.prototype.init=function(){this.stopAllBGM(),this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this._reserved_play_sound_name_map={},this._audio_source_map={}},r.prototype.loadSound=function(t,e,n){if(window&&window.Audio){var r=this;r.loading_audio_num++,"undefined"==typeof n&&(n=1);var i=function(){r.loaded_audio_num++},o=new window.Audio(e);o.volume=n,o.addEventListener("canplay",i),o.addEventListener("error",function(){throw new Error("Audio Element error. code: "+o.error.code+", message: "+o.error.message)}),o.load(),r.sounds[t]={audio:o}}},r.prototype.loadBGM=function(t,e,n,r,i){if(this.audio_context){var o=this;o.loading_audio_num++,"undefined"==typeof n&&(n=1);var a=function(e){o.loaded_audio_num++,o.bgms[t]={audio:e,volume:n,loopStart:r,loopEnd:i}},s=function(t){throw t instanceof Error?new Error(t.message):t},u=new XMLHttpRequest;u.onload=function(){if(200===u.status){var t=u.response;o.audio_context.decodeAudioData(t,a,s)}},u.open("GET",e,!0),u.responseType="arraybuffer",u.send(null)}},r.prototype.isAllLoaded=function(){return this.loaded_audio_num===this.loading_audio_num},r.prototype.playSound=function(t){if(this.audio_context){if(!(t in this.sounds))throw new Error("Can't find sound '"+t+"'.");this._reserved_play_sound_name_map[t]=!0}},r.prototype.executePlaySound=function(){for(var t in this._reserved_play_sound_name_map)this.sounds[t].audio.pause(),this.sounds[t].audio.currentTime=0,this.sounds[t].audio.play(),delete this._reserved_play_sound_name_map[t]},r.prototype.playSoundByDataURL=function(t,e){if(window&&window.Audio){"undefined"==typeof e&&(e=1);var n=new window.Audio;n.volume=e,n.src=t,n.addEventListener("canplay",function(){n.play()}),n.addEventListener("error",function(){throw new Error("Audio Element error. code: "+n.error.code+", message: "+n.error.message)}),n.load()}},r.prototype.playBGM=function(t){this.stopAllBGM(),this.addBGM(t)},r.prototype.addBGM=function(t){this.audio_context&&(this.isPlayingBGM(t)&&this.stopBGM(t),this._audio_source_map[t]=this._createSourceNodeAndGainNode(t),this._audio_source_map[t].source_node.start(0))},r.prototype.changeBGM=function(t){this.isPlayingBGM(t)||this.playBGM(t)},r.prototype.stopAllBGM=function(){for(var t in this._audio_source_map)this.stopBGM(t)},r.prototype.stopBGMWithout=function(t){for(var e in this._audio_source_map)e!==t&&this.stopBGM(e)},r.prototype.stopBGM=function(t){return"undefined"==typeof t?this.stopAllBGM():(this.fadeOutBGM(.1,t),void(t in this._audio_source_map&&delete this._audio_source_map[t]))},r.prototype.isPlayingBGM=function(t){return"undefined"==typeof t?Object.keys(this._audio_source_map).length?!0:!1:t in this._audio_source_map?!0:!1},r.prototype.fadeOutAllBGM=function(t){for(var e in this._audio_source_map)this.fadeOutBGM(t,e)},r.prototype.fadeOutBGM=function(t,e){if(this.audio_context){if("undefined"==typeof e)return this.fadeOutAllBGM(t);var n=this._audio_source_map[e];if(n){var r=n.gain_node,i=r.gain,o=this.audio_context.currentTime;i.cancelScheduledValues(o),i.setValueAtTime(i.value,o);var a=o+t;i.linearRampToValueAtTime(0,a)}}},r.prototype.muteAllBGM=function(){for(var t in this._audio_source_map)this.muteBGM(t)},r.prototype.muteBGM=function(t){if(this.audio_context){if("undefined"==typeof t)return this.muteAllBGM();var e=this._audio_source_map[t];if(e){var n=e.gain_node;n.gain.setValueAtTime(0,this.audio_context.currentTime)}}},r.prototype.unMuteAllBGM=function(){for(var t in this._audio_source_map)this.unMuteBGM(t)},r.prototype.unMuteBGM=function(t){if(this.audio_context){if("undefined"==typeof t)return this.unMuteAllBGM();var e=this._audio_source_map[t];if(e){var n=e.gain_node,r=this.bgms[t];n.gain.setValueAtTime(r.volume,this.audio_context.currentTime)}}},r.prototype.unMuteWithFadeInAllBGM=function(t){for(var e in this._audio_source_map)this.unMuteWithFadeInBGM(t,e)},r.prototype.unMuteWithFadeInBGM=function(t,e){if(this.audio_context){if("undefined"==typeof e)return this.unMuteWithFadeInAllBGM(t);var n=this._audio_source_map[e];if(n){var r=this.bgms[e],i=n.gain_node,o=i.gain,a=this.audio_context.currentTime;o.setValueAtTime(o.value,a);var s=a+t;o.linearRampToValueAtTime(r.volume,s)}}},r.prototype._createSourceNodeAndGainNode=function(t){if(this.audio_context){var e=this,n=e.bgms[t],r=e.audio_context.createBufferSource();r.buffer=n.audio,("loopStart"in n||"loopEnd"in n)&&(r.loop=!0),n.loopStart&&(r.loopStart=n.loopStart),n.loopEnd&&(r.loopEnd=n.loopEnd);var i=e.audio_context.createGain();return i.gain.setValueAtTime(n.volume,e.audio_context.currentTime),r.connect(i),i.connect(e.audio_context.destination),r.start=r.start||r.noteOn,r.stop=r.stop||r.noteOff,{source_node:r,gain_node:i}}},r.prototype.progress=function(){return 0===this.loading_audio_num?1:this.loaded_audio_num/this.loading_audio_num},e.exports=r},{}],8:[function(t,e,n){"use strict";var r=function(){this._isLoadedDone=!1,this._loadedFonts=null,this._fontStatues={},this._hiddenCanvas=null};r.prototype.init=function(){this._isLoadedDone=!1,this._loadedFonts=null,this._fontStatues={}},r.prototype.isAllLoaded=function(){for(var t in this._fontStatues)if(!this.isLoaded(t))return!1;return!0},r.prototype.progress=function(){var t=0,e=0;for(var n in this._fontStatues)t++,this.isLoaded(n)&&e++;return 0===t?1:e/t},r.prototype.setupEvents=function(){var t=this;t.canUseCssFontLoading()?window.document.fonts.ready.then(function(e){t._isLoadedDone=!0,t._loadedFonts=e})["catch"](function(t){throw new Error("Can't load font.")}):t.canUseCssFont()?window.document.fonts.addEventListener("loadingdone",function(){t._isLoadedDone=!0,t._loadedFonts=null}):(t._isLoadedDone=!0,t._loadedFonts=null)};var i=window.document&&window.document.fonts&&window.document.fonts.ready&&document.fonts.ready.then;r.prototype.canUseCssFontLoading=function(){return i},r.prototype.canUseCssFont=function(){return window.document&&window.document.fonts&&!this.isSafari10()},r.prototype.isSafari10=function(){return navigator.userAgent.toLowerCase().indexOf("safari")&&navigator.userAgent.toLowerCase().indexOf("version/10.0")},r.prototype.isLoaded=function(t){if(!(t in this._fontStatues))return!1;var e=this._fontStatues[t];if(e.is_loaded)return!0;var n=this.checkFontLoaded(t);return n&&(e.is_loaded=!0),n},r.prototype.checkFontLoaded=function(t){if(this.canUseCssFontLoading())return window.document.fonts.check('10px "'+t+'"');this._hiddenCanvas||(this._hiddenCanvas=window.document.createElement("canvas"));var e,n,r=this._hiddenCanvas.getContext("2d"),i="abcdefghijklmnopqrstuvwxyz";return r.font="40px "+t+", sans-serif",e=r.measureText(i).width,r.font="40px sans-serif",n=r.measureText(i).width,e!==n},r.prototype.loadFont=function(t,e,n){return window.document?(this._fontStatues[t]={is_loaded:!1},this._createFontFaceStyle(t,e,n),this._createFontLoadingDOM(t),!0):!1},r.prototype._createFontFaceStyle=function(t,e,n){var r=window.document.getElementsByTagName("head");if(!r)throw new Error("Fontloader class needs head tag in html file.");var i;i="undefined"!=typeof n?'@font-face { font-family: "'+t+'"; src: url("'+e+'") format("'+n+'"); }':'@font-face { font-family: "'+t+'"; src: url("'+e+'"); }';var o=window.document.createElement("style");o.type="text/css",r.item(0).appendChild(o),o.sheet.insertRule(i,0)},r.prototype._createFontLoadingDOM=function(t){var e=window.document.createElement("div"),n=window.document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(n),window.document.body.appendChild(e)},e.exports=r},{}],9:[function(t,e,n){"use strict";var r=function(){this.images={},this.loading_image_num=0,this.loaded_image_num=0};r.prototype.init=function(){for(var t in this.images)this.images[t].image.src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},r.prototype.loadImage=function(t,e,n,r){var i=this;i.loading_image_num++;var o=function(){i.loaded_image_num++},a=new Image;a.src=e,a.onload=o,this.images[t]={scale_width:n,scale_height:r,image:a}},r.prototype.isAllLoaded=function(){return this.loaded_image_num===this.loading_image_num},r.prototype.isLoaded=function(t){return t in this.images?!0:!1},r.prototype.getImage=function(t){if(!this.isLoaded(t))throw new Error("Can't find image '"+t+"'.");return this.images[t].image},r.prototype.getScaleWidth=function(t){if(!this.isLoaded(t))throw new Error("Can't find image '"+t+"'.");return this.images[t].scale_width},r.prototype.getScaleHeight=function(t){if(!this.isLoaded(t))throw new Error("Can't find image '"+t+"'.");return this.images[t].scale_height},r.prototype.progress=function(){return 0===this.loading_image_num?1:this.loaded_image_num/this.loading_image_num},e.exports=r},{}],10:[function(t,e,n){"use strict";var r={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128};e.exports=r},{}],11:[function(t,e,n){"use strict";var r={SPRITE3D:{}};r.SPRITE3D.V_ITEM_SIZE=3,r.SPRITE3D.V_ITEM_NUM=4,r.SPRITE3D.V_SIZE=r.SPRITE3D.V_ITEM_SIZE*r.SPRITE3D.V_ITEM_NUM,r.SPRITE3D.C_ITEM_SIZE=2,r.SPRITE3D.C_ITEM_NUM=4,r.SPRITE3D.C_SIZE=r.SPRITE3D.C_ITEM_SIZE*r.SPRITE3D.C_ITEM_NUM,r.SPRITE3D.I_ITEM_SIZE=1,r.SPRITE3D.I_ITEM_NUM=6,r.SPRITE3D.I_SIZE=r.SPRITE3D.I_ITEM_SIZE*r.SPRITE3D.I_ITEM_NUM,r.SPRITE3D.A_ITEM_SIZE=4,r.SPRITE3D.A_ITEM_NUM=4,r.SPRITE3D.A_SIZE=r.SPRITE3D.A_ITEM_SIZE*r.SPRITE3D.A_ITEM_NUM,e.exports=r},{}],12:[function(t,e,n){"use strict";var r=t("webgl-debug"),i=t("./util"),o=t("./manager/debug"),a=t("./manager/scene"),s=t("./manager/time"),u=t("./manager/save"),l=t("./manager/input"),c=t("./asset_loader/image"),h=t("./asset_loader/audio"),d=t("./asset_loader/font"),p=t("./storage/scenario"),f=t("./shader_program"),_=t("./shader/main.vs"),m=t("./shader/main.fs"),g=function(t,e){e||(e={}),this.canvas_dom=t,this.ctx=null,this.gl=null,e.webgl?(this.gl=this.createWebGLContext(this.canvas_dom),this.sprite_3d_shader=new f(this.gl,_,m,["aTextureCoordinates","aVertexPosition","aColor"],["uMVMatrix","uPMatrix","uSampler"])):this.ctx=this.canvas_dom.getContext("2d"),this.debug_manager=new o(this),this.scene_manager=new a(this),this.time_manager=new s(this),this.save_manager=new u,this.input_manager=new l,this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this._cursor_image_name=null,this._default_cursor_image_name=null,this.frame_count=0,this.request_id=null,this.image_loader=new c,this.audio_loader=new h,this.font_loader=new d,this.save_manager.addClass("scenario",p)};g.prototype.init=function(){this.frame_count=0,this.request_id=null,this.debug_manager.init(),this.scene_manager.init(),this.time_manager.init(),this.input_manager.init(),this.image_loader.init(),this.audio_loader.init(),this.font_loader.init(),this.save_manager.initialLoad()},g.prototype.reload=function(){this.init()},g.prototype.isRunning=function(){return this.request_id?!0:!1},g.prototype.startRun=function(){this.isRunning()||this.run()},g.prototype.stopRun=function(){this.isRunning()&&(cancelAnimationFrame(this.request_id),this.request_id=null)},g.prototype.run=function(){this.debug_manager.beforeRun(),this.scene_manager.beforeRun(),this.input_manager.beforeRun(),this.time_manager.executeEvents(),this.audio_loader.executePlaySound(),this.changeDefaultCursorImage();var t=this.scene_manager.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw(),this.scene_manager.drawTransition(),this._renderCursorImage()),this.frame_count++,this.debug_manager.afterRun(),this.input_manager.afterRun(),this.request_id=requestAnimationFrame(i.bind(this.run,this))},g.prototype.clearCanvas=function(){this.is2D()?this.ctx.clearRect(0,0,this.width,this.height):this.is3D()&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT))},g.prototype.is2D=function(){return this.ctx?!0:!1},g.prototype.is3D=function(){return this.gl?!0:!1},g.prototype.isKeyDown=function(t){return this.input_manager.isKeyDown(t)},g.prototype.isKeyPush=function(t){return this.input_manager.isKeyPush(t)},g.prototype.getKeyDownTime=function(t){return this.input_manager.getKeyDownTime(t)},g.prototype.isLeftClickDown=function(){return this.input_manager.isLeftClickDown()},g.prototype.isLeftClickPush=function(){return this.input_manager.isLeftClickPush()},g.prototype.isRightClickDown=function(){return this.input_manager.isRightClickDown()},g.prototype.isRightClickPush=function(){return this.input_manager.isRightClickPush()},g.prototype.mousePositionX=function(){return this.input_manager.mousePositionX()},g.prototype.mousePositionY=function(){return this.input_manager.mousePositionX()},g.prototype.mouseMoveX=function(){return this.input_manager.mouseMoveX()},g.prototype.mouseMoveY=function(){return this.input_manager.mouseMoveY()},g.prototype.mouseScroll=function(){return this.input_manager.mouseScroll()},g.prototype.fullscreen=function(){var t=this.canvas_dom;t.requestFullscreen?t.requestFullscreen():t.msRequestuestFullscreen?t.msRequestuestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},g.prototype.isAllLoaded=function(){return this.image_loader.isAllLoaded()&&this.audio_loader.isAllLoaded()&&this.font_loader.isAllLoaded()?!0:!1},g.prototype.setupEvents=function(){window&&(window.AudioContext=function(){return window.AudioContext||window.webkitAudioContext}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),this._setupError(),this.font_loader.setupEvents(),this.input_manager.setupEvents(this.canvas_dom))},g.prototype._setupError=function(){var t=this;window.onerror=function(e,n,r,i,o){t.showError(e,n,r,i,o)}},g.prototype.showError=function(t,e,n,r,i){if(this.clearCanvas(),this.is2D()){var o=this.ctx,a=24,s=80;o.save(),o.fillStyle="black",o.fillRect(0,0,this.width,this.height),o.restore(),o.save(),o.fillStyle="red",o.font="48px 'sans-serif'",o.fillText("Error",a,s),s+=48,o.fillStyle="white",o.font="24px 'sans-serif'",o.fillText(t,a,s),s+=29,o.fillText("Time: "+(new Date).toString(),a,s),s+=29,o.fillText("File: "+e,a,s),s+=29,o.fillText("Line: "+n+", Column:"+r,a,s),s+=29,o.fillText("Stack Trace: ",a,s),s+=29,a+=29;for(var u=i.stack.split("\n"),l=0,c=u.length;c>l;l++){var h=u[l];o.fillText(h,a,s),s+=29}o.restore()}else this.is3D()&&window.alert(t+"\n"+n+":"+r)},g.prototype.createWebGLContext=function(t){var e;try{e=t.getContext("webgl")||t.getContext("experimental-webgl"),e=r.makeDebugContext(e)}catch(n){throw n}if(!e)throw new Error("Could not initialize WebGL");return e},g.prototype.enableCursorImage=function(t){this.canvas_dom.style.cursor="none",this._default_cursor_image_name=t},g.prototype.isUsingCursorImage=function(){return this._default_cursor_image_name?!0:!1},g.prototype.changeCursorImage=function(t){this._cursor_image_name=t},g.prototype.disableCursorImage=function(t){this.isUsingCursorImage()&&(this.canvas_dom.style.cursor="auto",this._cursor_image_name=null,this._default_cursor_image_name=null)},g.prototype.changeDefaultCursorImage=function(){this.isUsingCursorImage()&&(this._cursor_image_name=this._default_cursor_image_name)},g.prototype._renderCursorImage=function(){if(this.isUsingCursorImage()&&this.image_loader.isLoaded(this._cursor_image_name)){var t=this.ctx;if(t){t.save();var e=this.image_loader.getImage(this._cursor_image_name),n=this.input_manager.mousePositionX(),r=this.input_manager.mousePositionY(),i=this.image_loader.getScaleWidth(this._cursor_image_name),o=this.image_loader.getScaleHeight(this._cursor_image_name);t.translate(n,r),t.drawImage(e,0,0,e.width*i,e.height*o),t.restore()}}},g.prototype.setTimeout=function(t,e){console.error("core's setTimeout method is deprecated."),this.time_manager.setTimeout(t,e)},g.prototype.currentScene=function(){return console.error("core's currentScene method is deprecated."),this.scene_manager.currentScene.apply(this.scene_manager,arguments)},g.prototype.addScene=function(t,e){return console.error("core's addScene method is deprecated."),this.scene_manager.addScene.apply(this.scene_manager,arguments)},g.prototype.changeScene=function(t,e){return console.error("core's changeScene method is deprecated."),this.scene_manager.changeScene.apply(this.scene_manager,arguments)},g.prototype.changeNextSceneIfReserved=function(){return console.error("core's changeNextSceneIfReserved method is deprecated."),this.scene_manager.changeNextSceneIfReserved.apply(this.scene_manager,arguments)},g.prototype.changeSceneWithLoading=function(t,e){return console.error("core's changeSceneWithLoading method is deprecated."),this.scene_manager.changeSceneWithLoading.apply(this.scene_manager,arguments)},e.exports=g},{"./asset_loader/audio":7,"./asset_loader/font":8,"./asset_loader/image":9,"./manager/debug":14,"./manager/input":15,"./manager/save":16,"./manager/scene":18,"./manager/time":20,"./shader/main.fs":50,"./shader/main.vs":51,"./shader_program":52,"./storage/scenario":55,"./util":56,"webgl-debug":33}],13:[function(t,e,n){"use strict";var r={util:t("./util"),core:t("./core"),shader_program:t("./shader_program"),constant:t("./util").assign(t("./constant/button"),{button:t("./constant/button")}),serif_manager:t("./manager/scenario"),save_manager:t("./manager/save"),manager:{save:t("./manager/save"),scenario:t("./manager/scenario")},scene:{base:t("./scene/base"),loading:t("./scene/loading"),movie:t("./scene/movie")},object:{base:t("./object/base"),point:t("./object/point"),sprite:t("./object/sprite"),sprite3d:t("./object/sprite3d"),pool_manager:t("./object/pool_manager"),pool_manager3d:t("./object/pool_manager3d"),ui_parts:t("./object/ui_parts")},asset_loader:{image:t("./asset_loader/image"),audio:t("./asset_loader/audio"),font:t("./asset_loader/font")},storage:{base:t("./storage/base"),save:t("./storage/save")},Util:t("./util"),Core:t("./core"),ShaderProgram:t("./shader_program"),Constant:{Button:t("./constant/button")},Manager:{Save:t("./manager/save"),Scenario:t("./manager/scenario")},Scene:{Base:t("./scene/base"),Loading:t("./scene/loading"),Movie:t("./scene/movie")},Object:{Base:t("./object/base"),Point:t("./object/point"),Sprite:t("./object/sprite"),Sprite3d:t("./object/sprite3d"),PoolManager:t("./object/pool_manager"),PoolManager3d:t("./object/pool_manager3d"),UIParts:t("./object/ui_parts"),UI:{Base:t("./object/ui/base"),Text:t("./object/ui/text"),Spinner:t("./object/ui/spinner"),Group:t("./object/ui/group"),Image:t("./object/ui/image")}},AssetLoader:{Image:t("./asset_loader/image"),Audio:t("./asset_loader/audio"),Font:t("./asset_loader/font")},Storage:{Base:t("./storage/base"),Save:t("./storage/save")},Master:{RepositoryGenerator:t("./master/repository_generator")}};e.exports=r},{"./asset_loader/audio":7,"./asset_loader/font":8,"./asset_loader/image":9,"./constant/button":10,"./core":12,"./manager/save":16,"./manager/scenario":17,"./master/repository_generator":22,"./object/base":35,"./object/point":36,"./object/pool_manager":37,"./object/pool_manager3d":38,"./object/sprite":39,"./object/sprite3d":40,"./object/ui/base":41,"./object/ui/group":42,"./object/ui/image":43,"./object/ui/spinner":44,"./object/ui/text":45,"./object/ui_parts":46,"./scene/base":47,"./scene/loading":48,"./scene/movie":49,"./shader_program":52,"./storage/base":53,"./storage/save":54,"./util":56}],14:[function(t,e,n){"use strict";var r=t("../util"),i=60,o=function(t){this.core=t,this.dom=null,this.is_debug_mode=!1,this._is_showing_collision_area=!1,this._is_showing_fps=!1,this._variables={},this._before_time=0,this._fps=0};o.prototype.init=function(){this._before_time=0,this._fps=0},o.prototype.setOn=function(t){this.is_debug_mode=!0,this.dom=t},o.prototype.setOff=function(){this.is_debug_mode=!1,this.dom=null},o.prototype.set=function(t,e){this.is_debug_mode&&(this._variables[t]=e)},o.prototype.get=function(t){return this.is_debug_mode?this._variables[t]:null},o.prototype.beforeRun=function(){this.isShowingFps()&&this._calculateFps()},o.prototype._calculateFps=function(){if(this.core.frame_count%i===0){var t=Date.now();this._before_time&&(this._fps=Math.floor(1e3*i/(t-this._before_time))),this._before_time=t}},o.prototype.afterRun=function(){this.isShowingFps()&&this._renderFps()},o.prototype._renderFps=function(){var t=this.core.ctx;t.save(),t.fillStyle="red",t.textAlign="left",t.font="16px 'sans-serif'",t.fillText("FPS: "+this._fps,this.core.width-70,this.core.height-10),t.restore()},o.prototype.addMenuText=function(t){if(this.is_debug_mode){var e=window.document.createElement("pre");e.textContent=t,this.dom.appendChild(e)}},o.prototype.addNewLine=function(){if(this.is_debug_mode){var t=window.document.createElement("br");this.dom.appendChild(t)}},o.prototype.addMenuImage=function(t){if(this.is_debug_mode){var e=window.document.createElement("img");e.src=t,this.dom.appendChild(e)}},o.prototype.addMenuButton=function(t,e){if(this.is_debug_mode){var n=this.core,r=window.document.createElement("input");r.setAttribute("type","button"),r.setAttribute("value",t),r.onclick=function(){e(n)},this.dom.appendChild(r)}},o.prototype.addMenuSelect=function(t,e,n){if(this.is_debug_mode){var r=this.core,i=window.document.createElement("select"),o=document.createElement("option");o.setAttribute("value",""),o.appendChild(document.createTextNode(t)),i.appendChild(o),i.onchange=function(){""!==i.value&&n(r,i.value)};for(var a=0,s=e.length;s>a;a++){var u=e[a],l=u.value,c=c in u?u.name:l,h=document.createElement("option");h.setAttribute("value",l),h.appendChild(document.createTextNode(c)),i.appendChild(h)}this.dom.appendChild(i)}},o.prototype.addGitLatestCommitInfo=function(t,e,n){if(this.is_debug_mode){n=n||"master";var r=window.document.createElement("pre");this.dom.appendChild(r);var i="https://api.github.com/repos/"+t+"/"+e+"/branches/"+n,o=new XMLHttpRequest;o.onload=function(){if(200===o.status){var t,e=o.response;if(!e)throw new Error("Can't parse git lastest commit info");t=JSON.parse(e),r.textContent="last update date: "+new Date(t.commit.commit.author.date)+"\n"}},o.open("GET",i,!0),o.send(null)}};var a=function(t){for(var e=t.split(","),n=atob(e[1]),r=e[0].split(":")[1].split(";")[0],i=new Uint8Array(n.length),o=0;o<n.length;o++)i[o]=n.charCodeAt(o);var a=new Blob([i],{type:r});return a};o.prototype.addCaputureImageButton=function(t,e){if(this.is_debug_mode){var n=this.core.canvas_dom;this.addMenuButton(t,function(){var t=e;if("undefined"==typeof e){var i=new Date;t=Math.floor(i.getTime()/1e3)}var o=n.toDataURL("image/png"),s=a(o);r.downloadBlob(s,t+".png")})}};var s={array_buffer:"readAsArrayBuffer",binary_string:"readAsBinaryString",text:"readAsText",data_url:"readAsDataURL"};o.prototype.addUploadFileButton=function(t,e,n){if(this.is_debug_mode){if("undefined"==typeof n&&(n="array_buffer"),!s[n])throw new Error("Unknown read_type: "+n);var r=window.document.createElement("pre");r.style.display="inline",r.textContent=t,this.dom.appendChild(r);var i=window.document.createElement("input");i.setAttribute("type","file");var o=s[n],a=this.core;i.onchange=function(t){if(i.value){var n=t.target.files[0],r=new FileReader,s=n.type;r.onload=function(t){var n=t.target.result;e(a,s,n)},r[o](n)}},i.onclick=function(t){i.value=null},this.dom.appendChild(i)}},o.prototype.setShowingCollisionAreaOn=function(){return this.is_debug_mode?void(this._is_showing_collision_area=!0):null},o.prototype.setShowingCollisionAreaOff=function(){return this.is_debug_mode?void(this._is_showing_collision_area=!1):null},o.prototype.isShowingCollisionArea=function(){return this.is_debug_mode?this._is_showing_collision_area:!1},o.prototype.setShowingFpsOn=function(){return this.is_debug_mode?void(this._is_showing_fps=!0):null},o.prototype.setShowingFpsOff=function(){return this.is_debug_mode?void(this._is_showing_fps=!1):null},o.prototype.isShowingFps=function(){return this.is_debug_mode?this._is_showing_fps:!1},e.exports=o},{"../util":56}],15:[function(t,e,n){"use strict";var r=t("../constant/button"),i=t("../util"),o=t("../object/point"),a={0:r.BUTTON_Z,1:r.BUTTON_X,2:r.BUTTON_SPACE,3:r.BUTTON_SHIFT},s=function(){this.current_keyflag=0,this.before_keyflag=0,this._key_bit_code_to_down_time={},this._button_id_to_key_bit_code=i.shallowCopyHash(a),this.is_left_clicked=!1,this.is_right_clicked=!1,this.before_is_left_clicked=!1,this.before_is_right_clicked=!1,this.mouse_change_x=0,this.mouse_change_y=0,this.mouse_x=0,this.mouse_y=0,this.mouse_scroll=0,this._is_gamepad_usable=!1};s.prototype.init=function(){this.current_keyflag=0,this.before_keyflag=0,this.initPressedKeyTime(),this._button_id_to_key_bit_code=i.shallowCopyHash(a),this.is_left_clicked=!1,this.is_right_clicked=!1,this.before_is_left_clicked=!1,this.before_is_right_clicked=!1,this.mouse_change_x=0,this.mouse_change_y=0,this.mouse_x=0,this.mouse_y=0,this.mouse_scroll=0},s.prototype.beforeRun=function(){this.handleGamePad(),this.handlePressedKeyTime()},s.prototype.afterRun=function(){this.before_keyflag=this.current_keyflag,this.before_is_left_clicked=this.is_left_clicked,this.before_is_right_clicked=this.is_right_clicked,this.mouse_scroll=0,this.mouse_change_x=0,this.mouse_change_y=0},s.prototype.handleKeyDown=function(t){this.current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},s.prototype.handleKeyUp=function(t){this.current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},s.prototype.isKeyDown=function(t){return this.current_keyflag&t?!0:!1},s.prototype.isKeyPush=function(t){return!(this.before_keyflag&t)&&this.current_keyflag&t},s.prototype.getKeyDownTime=function(t){return this._key_bit_code_to_down_time[t]},s.prototype.handleMouseDown=function(t){"which"in t?(this.is_left_clicked=1===t.which,this.is_right_clicked=3===t.which):"button"in t&&(this.is_left_clicked=1===t.button,this.is_right_clicked=2===t.button),t.preventDefault()},s.prototype.handleMouseUp=function(t){"which"in t?(this.is_left_clicked=1===t.which?!1:this.is_left_clicked,this.is_right_clicked=3===t.which?!1:this.is_right_clicked):"button"in t&&(this.is_left_clicked=1===t.button?!1:this.is_left_clicked,this.is_right_clicked=2===t.button?!1:this.is_right_clicked),t.preventDefault()},s.prototype.isLeftClickDown=function(){return this.is_left_clicked},s.prototype.isLeftClickPush=function(){return this.is_left_clicked&&!this.before_is_left_clicked},s.prototype.isRightClickDown=function(){return this.is_right_clicked},s.prototype.isRightClickPush=function(){return this.is_right_clicked&&!this.before_is_right_clicked},s.prototype.handleMouseMove=function(t){t=t?t:window.event,t.preventDefault();var e=t.target.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top;this.mouse_change_x=this.mouse_x-n,this.mouse_change_y=this.mouse_y-r,this.mouse_x=n,this.mouse_y=r},s.prototype.mousePositionPoint=function(t){var e=this.mousePositionX(),n=this.mousePositionY(),r=new o(t);return r.init(),r.setPosition(e,n),r},s.prototype.mousePositionX=function(){return this.mouse_x},s.prototype.mousePositionY=function(){return this.mouse_y},s.prototype.mouseMoveX=function(){return this.mouse_change_x},s.prototype.mouseMoveY=function(){return this.mouse_change_y},s.prototype.handleMouseWheel=function(t){this.mouse_scroll=t.detail?t.detail:-t.wheelDelta/120},s.prototype.mouseScroll=function(){return this.mouse_scroll},s.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=r.BUTTON_SHIFT;break;case 32:e=r.BUTTON_SPACE;break;case 37:e=r.BUTTON_LEFT;break;case 38:e=r.BUTTON_UP;break;case 39:e=r.BUTTON_RIGHT;break;case 40:e=r.BUTTON_DOWN;break;case 88:e=r.BUTTON_X;break;case 90:e=r.BUTTON_Z}return e},s.prototype.handleGamePad=function(){if(this._is_gamepad_usable){var t=window.navigator.getGamepads(),e=t[0];if(e){for(var n=0,i=e.buttons.length;i>n;n++)n in this._button_id_to_key_bit_code&&(e.buttons[n].pressed?this.current_keyflag|=this.getKeyByButtonId(n):this.current_keyflag&=~this.getKeyByButtonId(n));e.axes[1]<-.5?this.current_keyflag|=r.BUTTON_UP:this.current_keyflag&=~r.BUTTON_UP,e.axes[1]>.5?this.current_keyflag|=r.BUTTON_DOWN:this.current_keyflag&=~r.BUTTON_DOWN,e.axes[0]<-.5?this.current_keyflag|=r.BUTTON_LEFT:this.current_keyflag&=~r.BUTTON_LEFT,e.axes[0]>.5?this.current_keyflag|=r.BUTTON_RIGHT:this.current_keyflag&=~r.BUTTON_RIGHT}}},s.prototype.initPressedKeyTime=function(){this._key_bit_code_to_down_time={};for(var t in r){var e=r[t];this._key_bit_code_to_down_time[e]=0}},s.prototype.handlePressedKeyTime=function(){for(var t in r){var e=r[t];this.isKeyDown(e)?this._key_bit_code_to_down_time[e]++:this._key_bit_code_to_down_time[e]=0}},s.prototype.setupEvents=function(t){var e=this;window.onkeydown=function(t){e.handleKeyDown(t)},window.onkeyup=function(t){
e.handleKeyUp(t)},t.onmousedown=function(t){e.handleMouseDown(t)},t.onmouseup=function(t){e.handleMouseUp(t)},t.onmousemove=function(t){e.handleMouseMove(t)};var n=window.navi&&/Firefox/i.test(window.navigator.userAgent)?"DOMMouseScroll":"mousewheel";t.addEventListener&&t.addEventListener(n,function(t){var n=window.event||t;e.handleMouseWheel(n)},!1),t.oncontextmenu=function(){return!1},window.Gamepad&&window.navigator&&window.navigator.getGamepads&&(e._is_gamepad_usable=!0)},s.prototype.getKeyByButtonId=function(t){var e=this._button_id_to_key_bit_code[t];return e||(e=0),e},s.prototype.getAnyButtonId=function(){if(this._is_gamepad_usable){var t=window.navigator.getGamepads(),e=t[0];if(e)for(var n=0;n<e.buttons.length;n++)if(e.buttons[n].pressed)return n}},e.exports=s},{"../constant/button":10,"../object/point":36,"../util":56}],16:[function(t,e,n){"use strict";var r=function(){this._name_to_class={}};r.prototype.addClass=function(t,e){if("undefined"!=typeof this[t])throw new Error(t+" is reserved word.");this._name_to_class[t]=e},r.prototype.initialLoad=function(){for(var t in this._name_to_class){var e=this._name_to_class[t];this[t]||(this[t]=e.load())}},r.prototype.load=function(){for(var t in this._name_to_class){var e=this._name_to_class[t];this[t]=e.load()}},r.prototype.save=function(){for(var t in this._name_to_class)this[t].save()},r.prototype.reload=function(){for(var t in this._name_to_class)this[t].reload()},r.prototype.del=function(){for(var t in this._name_to_class)this[t].del()},e.exports=r},{}],17:[function(t,e,n){"use strict";var r=10,i=0,o=t("../util"),a=t("./serif_abolished_notifier_base"),s=function(t,e){this.core=t,e=e||{},this._typography_speed="typography_speed"in e?e.typography_speed:r,this._criteria_function_map="criteria"in e?e.criteria:{},this._event_to_callback={printend:function(){}},this._timeoutID=null,this._script=null,this._progress=null,this._current_talking_pos=null,this._pos_to_chara_id_map={},this._pos_to_exp_id_map={},this._is_background_changed=!1,this._current_bg_image_name=null,this._current_junction_list=[],this._current_option={},this._current_message_letter_list=[],this._current_message_sentenses_num=null,this._current_message_max_length_letters=null,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[]};o.inherit(s,a),s.prototype.init=function(t){if(!t)throw new Error("set script arguments to use scenario_manager class");this._timeoutID&&this._stopPrintLetter(),this._script=t.slice(),this._progress=-1,this._current_talking_pos=null,this._pos_to_chara_id_map={},this._pos_to_exp_id_map={},this._is_background_changed=!1,this._current_bg_image_name=null,this._current_junction_list=[],this._current_option={},this._current_message_letter_list=[],this._current_message_sentenses_num=null,this._current_message_max_length_letters=null,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[]},s.prototype.on=function(t,e){return this._event_to_callback[t]=e,this},s.prototype.removeEvent=function(t){return this._event_to_callback[t]=function(){},this},s.prototype.start=function(t){if(!this._script)throw new Error("start method must be called after instance was initialized.");this.isEnd()||(this._progress=t||0,this._chooseNextSerifScript(),this._setupCurrentSerifScript())},s.prototype.next=function(t){return t=t||0,this.isEnd()?!1:(this._progress++,this._chooseNextSerifScript(t),this._setupCurrentSerifScript(),!0)},s.prototype._chooseNextSerifScript=function(t){var e,n=this._script[this._progress],r=n.type||"serif";if("serif"===r);else if("junction_serif"===r){if(e=n.serifs[t],!e)throw new Error("chosen junction index '"+t+"' does not exists in next serifs array");Array.prototype.splice.apply(this._script,[this._progress,1].concat(e))}else{if("criteria_serif"!==r)throw new Error("Unknown serif script type: "+r);var i=n.criteria,o=n.arguments;if(t=this._execCriteriaFunction(i,o),e=n.serifs[t],!e)throw new Error("choisen criteria index '"+t+"' does not exists");Array.prototype.splice.apply(this._script,[this._progress,1].concat(e)),this._chooseNextSerifScript()}},s.prototype._execCriteriaFunction=function(t,e){var n=this._criteria_function_map[t];if(!n)throw new Error(t+" criteria does not exists");return n.apply({},[this.core].concat(e))},s.prototype.isStart=function(){return this._progress>-1},s.prototype.isEnd=function(){return this._progress===this._script.length-1},s.prototype.isPrintLetterEnd=function(){var t=this._current_message_letter_list.length;return this._letter_idx>=t?!0:!1},s.prototype._setupCurrentSerifScript=function(){var t=this._script[this._progress];this._setupChara(t),this._setupBackground(t),this._setupJunction(t),this._setupOption(t),this._saveSerifPlayed(t),"string"==typeof t.serif?this._setupSerif(t):this.isEnd()||this.next()},s.prototype._setupChara=function(t){var e=t.pos,n=t.chara,r=t.exp;e||(e=i),this._current_talking_pos=e,this._pos_to_chara_id_map[this._current_talking_pos]=n,this._pos_to_exp_id_map[this._current_talking_pos]=r},s.prototype._setupBackground=function(t){var e=t.background;this._is_background_changed=!1,e&&this._current_bg_image_name!==e&&(this._is_background_changed=!0,this._current_bg_image_name=e)},s.prototype._setupJunction=function(t){var e=t.junction;this._current_junction_list=e||[]},s.prototype._setupOption=function(t){this._current_option=t.option||{}},s.prototype._saveSerifPlayed=function(t){var e=t.id,n=t.save;if(n){if("undefined"==typeof e)throw new Error("script save property needs id property");this.core.save_manager.scenario.incrementPlayedCount(e)}},s.prototype._setupSerif=function(t){var e=t.serif;this._stopPrintLetter(),this._current_message_letter_list=e.split("");var n=e.split("\n");this._current_message_max_length_letters=0;for(var r=0,i=n.length;i>r;r++)this._current_message_max_length_letters<n[r].length&&(this._current_message_max_length_letters=n[r].length);this._current_message_sentenses_num=n.length,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[],this._startPrintLetter()},s.prototype._startPrintLetter=function(){this._printLetter(),this.isPrintLetterEnd()?this._timeoutID=null:this._timeoutID=setTimeout(o.bind(this._startPrintLetter,this),this._typography_speed)},s.prototype._stopPrintLetter=function(){null!==this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},s.prototype._printLetter=function(){if(!this.isPrintLetterEnd()){var t=this._current_message_letter_list,e=t[this._letter_idx++];this._current_printed_sentences[this._sentences_line_num]||(this._current_printed_sentences[this._sentences_line_num]=""),"\n"===e?this._sentences_line_num++:this._current_printed_sentences[this._sentences_line_num]+=e,this.isPrintLetterEnd()&&this._event_to_callback.printend()}},s.prototype.resumePrintLetter=function(){this._startPrintLetter()},s.prototype.pausePrintLetter=function(){this._stopPrintLetter()},s.prototype.getCurrentPrintedSentences=function(){return this._current_printed_sentences},s.prototype.getCurrentSentenceNum=function(){return this._current_message_sentenses_num},s.prototype.getCurrentMaxLengthLetters=function(){return this._current_message_max_length_letters},s.prototype.isBackgroundChanged=function(){return this._is_background_changed},s.prototype.getCurrentBackgroundImageName=function(){return this._current_bg_image_name},s.prototype.getCurrentOption=function(){return this._current_option},s.prototype.getCurrentCharaNameByPosition=function(t){return t=t||i,this._pos_to_chara_id_map[t]},s.prototype.getCurrentCharaExpressionByPosition=function(t){return t=t||i,this._pos_to_exp_id_map[t]},s.prototype.isCurrentTalkingByPosition=function(t){return this._current_talking_pos===t},s.prototype.isCurrentSerifExistsJunction=function(){return this._current_junction_list.length>0},s.prototype.getCurrentJunctionList=function(){return this._current_junction_list},e.exports=s},{"../util":56,"./serif_abolished_notifier_base":19}],18:[function(t,e,n){"use strict";var r=t("../scene/loading"),i=function(t){this.core=t,this._current_scene=null,this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init=!0,this._scenes={},this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null,this.addScene("loading",new r(t))};i.prototype.init=function(){this._current_scene=null,this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init=!0,this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null},i.prototype.beforeRun=function(){this._changeNextSceneIfReserved()},i.prototype.currentScene=function(){return null===this._current_scene?null:this._scenes[this._current_scene]},i.prototype.addScene=function(t,e){this._scenes[t]=e},i.prototype.changeScene=function(t,e){if(!(t in this._scenes))throw new Error(t+" scene doesn't exists.");var n=Array.prototype.slice.call(arguments);this._reserved_next_scene_name_and_arguments=n,this._is_reserved_next_scene_init=!0,this._current_scene||this._changeNextSceneIfReserved()},i.prototype.returnScene=function(t){if(!(t in this._scenes))throw new Error(t+" scene doesn't exists.");this._reserved_next_scene_name_and_arguments=[t],this._is_reserved_next_scene_init=!1},i.prototype._changeNextSceneIfReserved=function(){if(this._reserved_next_scene_name_and_arguments)if(this.isSetFadeOut()&&!this.isInFadeOut())this.startFadeOut();else if(this.isSetFadeOut()&&this.isInFadeOut());else{this._current_scene=this._reserved_next_scene_name_and_arguments.shift();var t=this.currentScene(),e=this._reserved_next_scene_name_and_arguments;this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init&&t.init.apply(t,e)}},i.prototype.changeSceneWithLoading=function(t,e){e||(e={}),this.changeScene("loading",e,t)},i.prototype.setFadeIn=function(t,e){this._fade_in_duration=t||30,this._fade_in_color=e||"white",this._startFadeIn()},i.prototype._startFadeIn=function(){this._quitFadeOut(),this._fade_in_start_frame_count=this.core.frame_count},i.prototype._quitFadeIn=function(){this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null},i.prototype.isInFadeIn=function(){return null!==this._fade_in_start_frame_count?!0:!1},i.prototype.setFadeOut=function(t,e){t="undefined"!=typeof t?t:30,this._fade_out_duration=t,this._fade_out_color=e||"black"},i.prototype.startFadeOut=function(){this.isSetFadeOut()&&(this._quitFadeIn(),this._fade_out_start_frame_count=this.core.frame_count)},i.prototype._quitFadeOut=function(){this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null},i.prototype.isInFadeOut=function(){return null!==this._fade_out_start_frame_count?!0:!1},i.prototype.isSetFadeOut=function(){return this._fade_out_duration&&this._fade_out_color?!0:!1},i.prototype.drawTransition=function(){var t,e=this.core.ctx;this.isInFadeIn()?(e.save(),t=this.core.frame_count-this._fade_in_start_frame_count<this._fade_in_duration?1-(this.core.frame_count-this._fade_in_start_frame_count)/this._fade_in_duration:0,e.globalAlpha=t,e.fillStyle=this._fade_in_color,e.fillRect(0,0,this.core.width,this.core.height),e.restore(),0===t&&this._quitFadeIn()):this.isInFadeOut()&&(e.save(),t=this.core.frame_count-this._fade_out_start_frame_count<this._fade_out_duration?(this.core.frame_count-this._fade_out_start_frame_count)/this._fade_out_duration:1,e.globalAlpha=t,e.fillStyle=this._fade_out_color,e.fillRect(0,0,this.core.width,this.core.height),e.restore(),1===t&&this._quitFadeOut())},e.exports=i},{"../scene/loading":48}],19:[function(t,e,n){"use strict";var r=function(t){};r.prototype.init=function(t){return console.error("this method is abolished.")},r.prototype.setAutoStart=function(t){return console.error("this method is abolished.")},r.prototype.isEnd=function(){return console.error("this method is abolished.")},r.prototype.isStart=function(){return console.error("this method is abolished.")},r.prototype.next=function(){return console.error("this method is abolished.")},r.prototype._showBackground=function(t){return console.error("this method is abolished.")},r.prototype._showChara=function(t){return console.error("this method is abolished.")},r.prototype._setOption=function(t){return console.error("this method is abolished.")},r.prototype._printMessage=function(t){return console.error("this method is abolished.")},r.prototype.isWaitingNext=function(){return console.error("this method is abolished.")},r.prototype.isEndPrinting=function(){return console.error("this method is abolished.")},r.prototype._startPrintMessage=function(){return console.error("this method is abolished.")},r.prototype._cancelPrintMessage=function(){return console.error("this method is abolished.")},r.prototype.startPrintMessage=function(){return console.error("this method is abolished.")},r.prototype.cancelPrintMessage=function(){return console.error("this method is abolished.")},r.prototype.isBackgroundChanged=function(){return console.error("this method is abolished.")},r.prototype.getBackgroundImageName=function(){return console.error("this method is abolished.")},r.prototype.getImageName=function(t){return console.error("this method is abolished.")},r.prototype.getChara=function(t){return console.error("this method is abolished.")},r.prototype.isTalking=function(t){return console.error("this method is abolished.")},r.prototype.getOption=function(){return console.error("this method is abolished.")},r.prototype.lines=function(){return console.error("this method is abolished.")},r.prototype.getSerifRowsCount=function(){return console.error("this method is abolished.")},r.prototype.right_image=function(){return console.error("this method is abolished.")},r.prototype.left_image=function(){return console.error("this method is abolished.")},r.prototype.is_right_talking=function(){return console.error("this method is abolished.")},r.prototype.is_left_talking=function(){return console.error("this method is abolished.")},r.prototype.font_color=function(){return console.error("this method is abolished.")},r.prototype.is_end=function(){return console.error("this method is abolished.")},r.prototype.is_background_changed=function(){return console.error("this method is abolished.")},r.prototype.background_image=function(){return console.error("this method is abolished.")},e.exports=r},{}],20:[function(t,e,n){"use strict";var r=0,i=function(t){this.core=t,this.events={}};i.prototype.init=function(){this.events={}},i.prototype.setTimeout=function(t,e){var n=this.core.frame_count,i=n+e,o=++r;return this.events[i]||(this.events[i]={}),this.events[i][o]={callback:t},o},i.prototype.clearTimeout=function(t){for(var e in this.events){var n=this.events[e];if(t in n)return delete n[t],!0}return!1},i.prototype.executeEvents=function(){var t=this.core.frame_count,e=this.events[t];if(e){for(var n in e){var r=e[n];r.callback()}delete this.events[t]}},e.exports=i},{}],21:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i={};i.exec=function(t,e){if(!t||"object"!==("undefined"==typeof t?"undefined":r(t)))throw new Error("type_info argument must be set");if(e=e||{pk:null},!e.pk)throw new Error("pk option must be set");var n=function(t){this._data=t||{}};for(var i in t){t[i];!function(t){n.prototype[t]=function(){return this._data[t]}}(i)}return n},e.exports=i},{}],22:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./dao_generator"),o={};o.exec=function(t,e,n){if(!t||"object"!==("undefined"==typeof t?"undefined":r(t)))throw new Error("type_info argument must be set");if(e=e||{pk:null,validate:!1},n=n||[],!e.pk)throw new Error("pk option must be set");for(var o=i.exec(t,e),a={},s=0,u=n.length;u>s;s++){var l=n[s];if(!(e.pk in l))throw new Error(e.pk+" key data does not exists in master data (index: "+s+")");var c=l[e.pk];a[c]=new o(l)}var h={};return h.DAOClass=o,h.find=function(t){return a[t]},h},e.exports=o},{"./dao_generator":21}],23:[function(t,e,n){n.glMatrix=t("./gl-matrix/common.js"),n.mat2=t("./gl-matrix/mat2.js"),n.mat2d=t("./gl-matrix/mat2d.js"),n.mat3=t("./gl-matrix/mat3.js"),n.mat4=t("./gl-matrix/mat4.js"),n.quat=t("./gl-matrix/quat.js"),n.vec2=t("./gl-matrix/vec2.js"),n.vec3=t("./gl-matrix/vec3.js"),n.vec4=t("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":24,"./gl-matrix/mat2.js":25,"./gl-matrix/mat2d.js":26,"./gl-matrix/mat3.js":27,"./gl-matrix/mat4.js":28,"./gl-matrix/quat.js":29,"./gl-matrix/vec2.js":30,"./gl-matrix/vec3.js":31,"./gl-matrix/vec4.js":32}],24:[function(t,e,n){var r={};r.EPSILON=1e-6,r.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,r.RANDOM=Math.random,r.ENABLE_SIMD=!1,r.SIMD_AVAILABLE=r.ARRAY_TYPE===Float32Array&&"SIMD"in this,r.USE_SIMD=r.ENABLE_SIMD&&r.SIMD_AVAILABLE,r.setMatrixArrayType=function(t){r.ARRAY_TYPE=t};var i=Math.PI/180;r.toRadian=function(t){return t*i},r.equals=function(t,e){return Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.exports=r},{}],25:[function(t,e,n){var r=t("./common.js"),i={};i.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},i.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},i.fromValues=function(t,e,n,i){var o=new r.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=i,o},i.set=function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},i.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},i.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*o-i*r;return a?(a=1/a,t[0]=o*a,t[1]=-r*a,t[2]=-i*a,t[3]=n*a,t):null},i.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},i.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},i.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],l=n[2],c=n[3];return t[0]=r*s+o*u,t[1]=i*s+a*u,t[2]=r*l+o*c,t[3]=i*l+a*c,t},i.mul=i.multiply,i.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t},i.scale=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1];return t[0]=r*s,t[1]=i*s,t[2]=o*u,t[3]=a*u,t},i.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t},i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},i.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},i.LDU=function(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]},i.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},i.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},i.sub=i.subtract,i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},i.equals=function(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=e[0],u=e[1],l=e[2],c=e[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-c)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))},i.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},i.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},e.exports=i},{"./common.js":24}],26:[function(t,e,n){var r=t("./common.js"),i={};i.create=function(){var t=new r.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},i.clone=function(t){var e=new r.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},i.fromValues=function(t,e,n,i,o,a){var s=new r.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s[4]=o,s[5]=a,s},i.set=function(t,e,n,r,i,o,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t},i.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=n*o-r*i;return u?(u=1/u,t[0]=o*u,t[1]=-r*u,t[2]=-i*u,t[3]=n*u,t[4]=(i*s-o*a)*u,t[5]=(r*a-n*s)*u,t):null},i.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},i.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=n[0],c=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return t[0]=r*l+o*c,t[1]=i*l+a*c,t[2]=r*h+o*d,t[3]=i*h+a*d,t[4]=r*p+o*f+s,t[5]=i*p+a*f+u,t},i.mul=i.multiply,i.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=Math.sin(n),c=Math.cos(n);return t[0]=r*c+o*l,t[1]=i*c+a*l,t[2]=r*-l+o*c,t[3]=i*-l+a*c,t[4]=s,t[5]=u,t},i.scale=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=n[0],c=n[1];return t[0]=r*l,t[1]=i*l,t[2]=o*c,t[3]=a*c,t[4]=s,t[5]=u,t},i.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=n[0],c=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=r*l+o*c+s,t[5]=i*l+a*c+u,t},i.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t},i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},i.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},i.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},i.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},i.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t},i.sub=i.subtract,i.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},i.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},i.equals=function(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=e[0],c=e[1],h=e[2],d=e[3],p=e[4],f=e[5];return Math.abs(n-l)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-h)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-d)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-p)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-f)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(f))},e.exports=i},{"./common.js":24}],27:[function(t,e,n){var r=t("./common.js"),i={};i.create=function(){var t=new r.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},i.clone=function(t){var e=new r.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},i.fromValues=function(t,e,n,i,o,a,s,u,l){var c=new r.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=i,c[4]=o,c[5]=a,c[6]=s,c[7]=u,c[8]=l,c},i.set=function(t,e,n,r,i,o,a,s,u,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},i.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*a-s*l,d=-c*o+s*u,p=l*o-a*u,f=n*h+r*d+i*p;return f?(f=1/f,t[0]=h*f,t[1]=(-c*r+i*l)*f,t[2]=(s*r-i*a)*f,t[3]=d*f,t[4]=(c*n-i*u)*f,t[5]=(-s*n+i*o)*f,t[6]=p*f,t[7]=(-l*n+r*u)*f,t[8]=(a*n-r*o)*f,t):null},i.adjoint=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t[0]=a*c-s*l,t[1]=i*l-r*c,t[2]=r*s-i*a,t[3]=s*u-o*c,t[4]=n*c-i*u,t[5]=i*o-n*s,t[6]=o*l-a*u,t[7]=r*u-n*l,t[8]=n*a-r*o,t},i.determinant=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8];return e*(l*o-a*u)+n*(-l*i+a*s)+r*(u*i-o*s)},i.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=n[0],p=n[1],f=n[2],_=n[3],m=n[4],g=n[5],v=n[6],y=n[7],b=n[8];return t[0]=d*r+p*a+f*l,t[1]=d*i+p*s+f*c,t[2]=d*o+p*u+f*h,t[3]=_*r+m*a+g*l,t[4]=_*i+m*s+g*c,t[5]=_*o+m*u+g*h,t[6]=v*r+y*a+b*l,t[7]=v*i+y*s+b*c,t[8]=v*o+y*u+b*h,t},i.mul=i.multiply,i.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=n[0],p=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=d*r+p*a+l,t[7]=d*i+p*s+c,t[8]=d*o+p*u+h,t},i.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=Math.sin(n),p=Math.cos(n);return t[0]=p*r+d*a,t[1]=p*i+d*s,t[2]=p*o+d*u,t[3]=p*a-d*r,t[4]=p*s-d*i,t[5]=p*u-d*o,t[6]=l,t[7]=c,t[8]=h,t},i.scale=function(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},i.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},i.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},i.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,d=i*a,p=i*s,f=i*u,_=o*a,m=o*s,g=o*u;return t[0]=1-h-f,t[3]=c-g,t[6]=d+m,t[1]=c+g,t[4]=1-l-f,t[7]=p-_,t[2]=d-m,t[5]=p+_,t[8]=1-l-h,t},i.normalFromMat4=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],d=e[10],p=e[11],f=e[12],_=e[13],m=e[14],g=e[15],v=n*s-r*a,y=n*u-i*a,b=n*l-o*a,x=r*u-i*s,M=r*l-o*s,w=i*l-o*u,S=c*_-h*f,I=c*m-d*f,D=c*g-p*f,E=h*m-d*_,F=h*g-p*_,T=d*g-p*m,A=v*T-y*F+b*E+x*D-M*I+w*S;return A?(A=1/A,t[0]=(s*T-u*F+l*E)*A,t[1]=(u*D-a*T-l*I)*A,t[2]=(a*F-s*D+l*S)*A,t[3]=(i*F-r*T-o*E)*A,t[4]=(n*T-i*D+o*I)*A,t[5]=(r*D-n*F-o*S)*A,t[6]=(_*w-m*M+g*x)*A,t[7]=(m*b-f*w-g*y)*A,t[8]=(f*M-_*b+g*v)*A,t):null},i.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},i.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},i.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t},i.sub=i.subtract,i.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},i.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},i.equals=function(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=e[0],p=e[1],f=e[2],_=e[3],m=e[4],g=e[5],v=t[6],y=e[7],b=e[8];return Math.abs(n-d)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-p)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-f)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-_)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-m)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-g)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-v)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(c-y)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-b)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))},e.exports=i},{"./common.js":24}],28:[function(t,e,n){var r=t("./common.js"),i={scalar:{},SIMD:{}};i.create=function(){var t=new r.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.clone=function(t){var e=new r.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},i.fromValues=function(t,e,n,i,o,a,s,u,l,c,h,d,p,f,_,m){var g=new r.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=n,g[3]=i,g[4]=o,g[5]=a,g[6]=s,g[7]=u,g[8]=l,g[9]=c,g[10]=h,g[11]=d,g[12]=p,g[13]=f,g[14]=_,g[15]=m,g},i.set=function(t,e,n,r,i,o,a,s,u,l,c,h,d,p,f,_,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=d,t[12]=p,t[13]=f,t[14]=_,t[15]=m,t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.scalar.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},i.SIMD.transpose=function(t,e){var n,r,i,o,a,s,u,l,c,h;return n=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4.shuffle(n,r,0,1,4,5),s=SIMD.Float32x4.shuffle(i,o,0,1,4,5),u=SIMD.Float32x4.shuffle(a,s,0,2,4,6),l=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,0,u),SIMD.Float32x4.store(t,4,l),a=SIMD.Float32x4.shuffle(n,r,2,3,6,7),s=SIMD.Float32x4.shuffle(i,o,2,3,6,7),c=SIMD.Float32x4.shuffle(a,s,0,2,4,6),h=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,h),t},i.transpose=r.USE_SIMD?i.SIMD.transpose:i.scalar.transpose,i.scalar.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],d=e[10],p=e[11],f=e[12],_=e[13],m=e[14],g=e[15],v=n*s-r*a,y=n*u-i*a,b=n*l-o*a,x=r*u-i*s,M=r*l-o*s,w=i*l-o*u,S=c*_-h*f,I=c*m-d*f,D=c*g-p*f,E=h*m-d*_,F=h*g-p*_,T=d*g-p*m,A=v*T-y*F+b*E+x*D-M*I+w*S;return A?(A=1/A,t[0]=(s*T-u*F+l*E)*A,t[1]=(i*F-r*T-o*E)*A,t[2]=(_*w-m*M+g*x)*A,t[3]=(d*M-h*w-p*x)*A,t[4]=(u*D-a*T-l*I)*A,t[5]=(n*T-i*D+o*I)*A,t[6]=(m*b-f*w-g*y)*A,t[7]=(c*w-d*b+p*y)*A,t[8]=(a*F-s*D+l*S)*A,t[9]=(r*D-n*F-o*S)*A,
t[10]=(f*M-_*b+g*v)*A,t[11]=(h*b-c*M-p*v)*A,t[12]=(s*I-a*E-u*S)*A,t[13]=(n*E-r*I+i*S)*A,t[14]=(_*y-f*x-m*v)*A,t[15]=(c*x-h*y+d*v)*A,t):null},i.SIMD.invert=function(t,e){var n,r,i,o,a,s,u,l,c,h,d=SIMD.Float32x4.load(e,0),p=SIMD.Float32x4.load(e,4),f=SIMD.Float32x4.load(e,8),_=SIMD.Float32x4.load(e,12);return a=SIMD.Float32x4.shuffle(d,p,0,1,4,5),r=SIMD.Float32x4.shuffle(f,_,0,1,4,5),n=SIMD.Float32x4.shuffle(a,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,a,1,3,5,7),a=SIMD.Float32x4.shuffle(d,p,2,3,6,7),o=SIMD.Float32x4.shuffle(f,_,2,3,6,7),i=SIMD.Float32x4.shuffle(a,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,a,1,3,5,7),a=SIMD.Float32x4.mul(i,o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.mul(r,a),u=SIMD.Float32x4.mul(n,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,a),s),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),a=SIMD.Float32x4.mul(r,i),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),s),c=SIMD.Float32x4.mul(n,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,a)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,2,3,0,1),o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),s),l=SIMD.Float32x4.mul(n,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(i,a)),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),a=SIMD.Float32x4.mul(n,r),a=SIMD.Float32x4.swizzle(a,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),l),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),c),a=SIMD.Float32x4.swizzle(a,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),l),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(i,a)),a=SIMD.Float32x4.mul(n,o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(i,a)),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),l),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),u),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(r,a)),a=SIMD.Float32x4.mul(n,i),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(r,a)),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(o,a)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),c),h=SIMD.Float32x4.mul(n,s),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,2,3,0,1),h),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,0,3,2),h),a=SIMD.Float32x4.reciprocalApproximation(h),h=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(h,SIMD.Float32x4.mul(a,a))),(h=SIMD.Float32x4.swizzle(h,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(h,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(h,u)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(h,l)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(h,c)),t):null},i.invert=r.USE_SIMD?i.SIMD.invert:i.scalar.invert,i.scalar.adjoint=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],d=e[10],p=e[11],f=e[12],_=e[13],m=e[14],g=e[15];return t[0]=s*(d*g-p*m)-h*(u*g-l*m)+_*(u*p-l*d),t[1]=-(r*(d*g-p*m)-h*(i*g-o*m)+_*(i*p-o*d)),t[2]=r*(u*g-l*m)-s*(i*g-o*m)+_*(i*l-o*u),t[3]=-(r*(u*p-l*d)-s*(i*p-o*d)+h*(i*l-o*u)),t[4]=-(a*(d*g-p*m)-c*(u*g-l*m)+f*(u*p-l*d)),t[5]=n*(d*g-p*m)-c*(i*g-o*m)+f*(i*p-o*d),t[6]=-(n*(u*g-l*m)-a*(i*g-o*m)+f*(i*l-o*u)),t[7]=n*(u*p-l*d)-a*(i*p-o*d)+c*(i*l-o*u),t[8]=a*(h*g-p*_)-c*(s*g-l*_)+f*(s*p-l*h),t[9]=-(n*(h*g-p*_)-c*(r*g-o*_)+f*(r*p-o*h)),t[10]=n*(s*g-l*_)-a*(r*g-o*_)+f*(r*l-o*s),t[11]=-(n*(s*p-l*h)-a*(r*p-o*h)+c*(r*l-o*s)),t[12]=-(a*(h*m-d*_)-c*(s*m-u*_)+f*(s*d-u*h)),t[13]=n*(h*m-d*_)-c*(r*m-i*_)+f*(r*d-i*h),t[14]=-(n*(s*m-u*_)-a*(r*m-i*_)+f*(r*u-i*s)),t[15]=n*(s*d-u*h)-a*(r*d-i*h)+c*(r*u-i*s),t},i.SIMD.adjoint=function(t,e){var n,r,i,o,a,s,u,l,c,h,d,p,f,n=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12);return c=SIMD.Float32x4.shuffle(n,r,0,1,4,5),s=SIMD.Float32x4.shuffle(i,o,0,1,4,5),a=SIMD.Float32x4.shuffle(c,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,c,1,3,5,7),c=SIMD.Float32x4.shuffle(n,r,2,3,6,7),l=SIMD.Float32x4.shuffle(i,o,2,3,6,7),u=SIMD.Float32x4.shuffle(c,l,0,2,4,6),l=SIMD.Float32x4.shuffle(l,c,1,3,5,7),c=SIMD.Float32x4.mul(u,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.mul(s,c),d=SIMD.Float32x4.mul(a,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),h),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,c),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),c=SIMD.Float32x4.mul(s,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),h),f=SIMD.Float32x4.mul(a,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(l,c)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),u=SIMD.Float32x4.swizzle(u,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),h),p=SIMD.Float32x4.mul(a,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(u,c)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,c),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),c=SIMD.Float32x4.mul(a,s),c=SIMD.Float32x4.swizzle(c,1,0,3,2),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),p),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),f),c=SIMD.Float32x4.swizzle(c,2,3,0,1),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,c),p),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,c)),c=SIMD.Float32x4.mul(a,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,c)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),p),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),d),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.mul(a,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),d),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(l,c)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),f),SIMD.Float32x4.store(t,0,h),SIMD.Float32x4.store(t,4,d),SIMD.Float32x4.store(t,8,p),SIMD.Float32x4.store(t,12,f),t},i.adjoint=r.USE_SIMD?i.SIMD.adjoint:i.scalar.adjoint,i.determinant=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],d=t[11],p=t[12],f=t[13],_=t[14],m=t[15],g=e*a-n*o,v=e*s-r*o,y=e*u-i*o,b=n*s-r*a,x=n*u-i*a,M=r*u-i*s,w=l*f-c*p,S=l*_-h*p,I=l*m-d*p,D=c*_-h*f,E=c*m-d*f,F=h*m-d*_;return g*F-v*E+y*D+b*I-x*S+M*w},i.SIMD.multiply=function(t,e,n){var r=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(n,0),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),a))));SIMD.Float32x4.store(t,0,u);var l=SIMD.Float32x4.load(n,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),a))));SIMD.Float32x4.store(t,4,c);var h=SIMD.Float32x4.load(n,8),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),a))));SIMD.Float32x4.store(t,8,d);var p=SIMD.Float32x4.load(n,12),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,1,1,1,1),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,3,3,3,3),a))));return SIMD.Float32x4.store(t,12,f),t},i.scalar.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=e[9],p=e[10],f=e[11],_=e[12],m=e[13],g=e[14],v=e[15],y=n[0],b=n[1],x=n[2],M=n[3];return t[0]=y*r+b*s+x*h+M*_,t[1]=y*i+b*u+x*d+M*m,t[2]=y*o+b*l+x*p+M*g,t[3]=y*a+b*c+x*f+M*v,y=n[4],b=n[5],x=n[6],M=n[7],t[4]=y*r+b*s+x*h+M*_,t[5]=y*i+b*u+x*d+M*m,t[6]=y*o+b*l+x*p+M*g,t[7]=y*a+b*c+x*f+M*v,y=n[8],b=n[9],x=n[10],M=n[11],t[8]=y*r+b*s+x*h+M*_,t[9]=y*i+b*u+x*d+M*m,t[10]=y*o+b*l+x*p+M*g,t[11]=y*a+b*c+x*f+M*v,y=n[12],b=n[13],x=n[14],M=n[15],t[12]=y*r+b*s+x*h+M*_,t[13]=y*i+b*u+x*d+M*m,t[14]=y*o+b*l+x*p+M*g,t[15]=y*a+b*c+x*f+M*v,t},i.multiply=r.USE_SIMD?i.SIMD.multiply:i.scalar.multiply,i.mul=i.multiply,i.scalar.translate=function(t,e,n){var r,i,o,a,s,u,l,c,h,d,p,f,_=n[0],m=n[1],g=n[2];return e===t?(t[12]=e[0]*_+e[4]*m+e[8]*g+e[12],t[13]=e[1]*_+e[5]*m+e[9]*g+e[13],t[14]=e[2]*_+e[6]*m+e[10]*g+e[14],t[15]=e[3]*_+e[7]*m+e[11]*g+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=r*_+s*m+h*g+e[12],t[13]=i*_+u*m+d*g+e[13],t[14]=o*_+l*m+p*g+e[14],t[15]=a*_+c*m+f*g+e[15]),t},i.SIMD.translate=function(t,e,n){var r=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(n[0],n[1],n[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,0,0,0,0)),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,2,2,2,2));var u=SIMD.Float32x4.add(r,SIMD.Float32x4.add(i,SIMD.Float32x4.add(o,a)));return SIMD.Float32x4.store(t,12,u),t},i.translate=r.USE_SIMD?i.SIMD.translate:i.scalar.translate,i.scalar.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},i.SIMD.scale=function(t,e,n){var r,i,o,a=SIMD.Float32x4(n[0],n[1],n[2],0);return r=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(a,0,0,0,0))),i=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(a,1,1,1,1))),o=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(a,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},i.scale=r.USE_SIMD?i.SIMD.scale:i.scalar.scale,i.rotate=function(t,e,n,i){var o,a,s,u,l,c,h,d,p,f,_,m,g,v,y,b,x,M,w,S,I,D,E,F,T=i[0],A=i[1],C=i[2],k=Math.sqrt(T*T+A*A+C*C);return Math.abs(k)<r.EPSILON?null:(k=1/k,T*=k,A*=k,C*=k,o=Math.sin(n),a=Math.cos(n),s=1-a,u=e[0],l=e[1],c=e[2],h=e[3],d=e[4],p=e[5],f=e[6],_=e[7],m=e[8],g=e[9],v=e[10],y=e[11],b=T*T*s+a,x=A*T*s+C*o,M=C*T*s-A*o,w=T*A*s-C*o,S=A*A*s+a,I=C*A*s+T*o,D=T*C*s+A*o,E=A*C*s-T*o,F=C*C*s+a,t[0]=u*b+d*x+m*M,t[1]=l*b+p*x+g*M,t[2]=c*b+f*x+v*M,t[3]=h*b+_*x+y*M,t[4]=u*w+d*S+m*I,t[5]=l*w+p*S+g*I,t[6]=c*w+f*S+v*I,t[7]=h*w+_*S+y*I,t[8]=u*D+d*E+m*F,t[9]=l*D+p*E+g*F,t[10]=c*D+f*E+v*F,t[11]=h*D+_*E+y*F,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},i.scalar.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+d*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=d*i-u*r,t},i.SIMD.rotateX=function(t,e,n){var r=SIMD.Float32x4.splat(Math.sin(n)),i=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),SIMD.Float32x4.mul(a,r))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,i),SIMD.Float32x4.mul(o,r))),t},i.rotateX=r.USE_SIMD?i.SIMD.rotateX:i.scalar.rotateX,i.scalar.rotateY=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*r,t[1]=a*i-c*r,t[2]=s*i-h*r,t[3]=u*i-d*r,t[8]=o*r+l*i,t[9]=a*r+c*i,t[10]=s*r+h*i,t[11]=u*r+d*i,t},i.SIMD.rotateY=function(t,e,n){var r=SIMD.Float32x4.splat(Math.sin(n)),i=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,i),SIMD.Float32x4.mul(a,r))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(a,i))),t},i.rotateY=r.USE_SIMD?i.SIMD.rotateY:i.scalar.rotateY,i.scalar.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+d*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=d*i-u*r,t},i.SIMD.rotateZ=function(t,e,n){var r=SIMD.Float32x4.splat(Math.sin(n)),i=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),SIMD.Float32x4.mul(a,r))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,i),SIMD.Float32x4.mul(o,r))),t},i.rotateZ=r.USE_SIMD?i.SIMD.rotateZ:i.scalar.rotateZ,i.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromRotation=function(t,e,n){var i,o,a,s=n[0],u=n[1],l=n[2],c=Math.sqrt(s*s+u*u+l*l);return Math.abs(c)<r.EPSILON?null:(c=1/c,s*=c,u*=c,l*=c,i=Math.sin(e),o=Math.cos(e),a=1-o,t[0]=s*s*a+o,t[1]=u*s*a+l*i,t[2]=l*s*a-u*i,t[3]=0,t[4]=s*u*a-l*i,t[5]=u*u*a+o,t[6]=l*u*a+s*i,t[7]=0,t[8]=s*l*a+u*i,t[9]=u*l*a-s*i,t[10]=l*l*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},i.fromXRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromYRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromZRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromRotationTranslation=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,l=o+o,c=r*s,h=r*u,d=r*l,p=i*u,f=i*l,_=o*l,m=a*s,g=a*u,v=a*l;return t[0]=1-(p+_),t[1]=h+v,t[2]=d-g,t[3]=0,t[4]=h-v,t[5]=1-(c+_),t[6]=f+m,t[7]=0,t[8]=d+g,t[9]=f-m,t[10]=1-(c+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},i.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},i.getRotation=function(t,e){var n=e[0]+e[5]+e[10],r=0;return n>0?(r=2*Math.sqrt(n+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t},i.fromRotationTranslationScale=function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,c=a+a,h=i*u,d=i*l,p=i*c,f=o*l,_=o*c,m=a*c,g=s*u,v=s*l,y=s*c,b=r[0],x=r[1],M=r[2];return t[0]=(1-(f+m))*b,t[1]=(d+y)*b,t[2]=(p-v)*b,t[3]=0,t[4]=(d-y)*x,t[5]=(1-(h+m))*x,t[6]=(_+g)*x,t[7]=0,t[8]=(p+v)*M,t[9]=(_-g)*M,t[10]=(1-(h+f))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},i.fromRotationTranslationScaleOrigin=function(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,c=a+a,h=s+s,d=o*l,p=o*c,f=o*h,_=a*c,m=a*h,g=s*h,v=u*l,y=u*c,b=u*h,x=r[0],M=r[1],w=r[2],S=i[0],I=i[1],D=i[2];return t[0]=(1-(_+g))*x,t[1]=(p+b)*x,t[2]=(f-y)*x,t[3]=0,t[4]=(p-b)*M,t[5]=(1-(d+g))*M,t[6]=(m+v)*M,t[7]=0,t[8]=(f+y)*w,t[9]=(m-v)*w,t[10]=(1-(d+_))*w,t[11]=0,t[12]=n[0]+S-(t[0]*S+t[4]*I+t[8]*D),t[13]=n[1]+I-(t[1]*S+t[5]*I+t[9]*D),t[14]=n[2]+D-(t[2]*S+t[6]*I+t[10]*D),t[15]=1,t},i.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,d=i*a,p=i*s,f=i*u,_=o*a,m=o*s,g=o*u;return t[0]=1-h-f,t[1]=c+g,t[2]=d-m,t[3]=0,t[4]=c-g,t[5]=1-l-f,t[6]=p+_,t[7]=0,t[8]=d+m,t[9]=p-_,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.frustum=function(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t},i.perspective=function(t,e,n,r,i){var o=1/Math.tan(e/2),a=1/(r-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*a,t[15]=0,t},i.perspectiveFromFieldOfView=function(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((a-s)*u*.5),t[9]=(i-o)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},i.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t},i.lookAt=function(t,e,n,o){var a,s,u,l,c,h,d,p,f,_,m=e[0],g=e[1],v=e[2],y=o[0],b=o[1],x=o[2],M=n[0],w=n[1],S=n[2];return Math.abs(m-M)<r.EPSILON&&Math.abs(g-w)<r.EPSILON&&Math.abs(v-S)<r.EPSILON?i.identity(t):(d=m-M,p=g-w,f=v-S,_=1/Math.sqrt(d*d+p*p+f*f),d*=_,p*=_,f*=_,a=b*f-x*p,s=x*d-y*f,u=y*p-b*d,_=Math.sqrt(a*a+s*s+u*u),_?(_=1/_,a*=_,s*=_,u*=_):(a=0,s=0,u=0),l=p*u-f*s,c=f*a-d*u,h=d*s-p*a,_=Math.sqrt(l*l+c*c+h*h),_?(_=1/_,l*=_,c*=_,h*=_):(l=0,c=0,h=0),t[0]=a,t[1]=l,t[2]=d,t[3]=0,t[4]=s,t[5]=c,t[6]=p,t[7]=0,t[8]=u,t[9]=h,t[10]=f,t[11]=0,t[12]=-(a*m+s*g+u*v),t[13]=-(l*m+c*g+h*v),t[14]=-(d*m+p*g+f*v),t[15]=1,t)},i.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},i.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},i.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t},i.sub=i.subtract,i.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},i.multiplyScalarAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},i.equals=function(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],_=t[12],m=t[13],g=t[14],v=t[15],y=e[0],b=e[1],x=e[2],M=e[3],w=e[4],S=e[5],I=e[6],D=e[7],E=e[8],F=e[9],T=e[10],A=e[11],C=e[12],k=e[13],P=e[14],R=e[15];return Math.abs(n-y)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-b)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-M)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(s-w)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-S)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-I)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-D)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-E)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(d-F)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(p-T)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(f-A)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(_-C)<=r.EPSILON*Math.max(1,Math.abs(_),Math.abs(C))&&Math.abs(m-k)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-P)<=r.EPSILON*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(v-R)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(R))},e.exports=i},{"./common.js":24}],29:[function(t,e,n){var r=t("./common.js"),i=t("./mat3.js"),o=t("./vec3.js"),a=t("./vec4.js"),s={};s.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.rotationTo=function(){var t=o.create(),e=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(r,i,a){var u=o.dot(i,a);return-.999999>u?(o.cross(t,e,i),o.length(t)<1e-6&&o.cross(t,n,i),o.normalize(t,t),s.setAxisAngle(r,t,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o.cross(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+u,s.normalize(r,r))}}(),s.setAxes=function(){var t=i.create();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],s.normalize(e,s.fromMat3(e,t))}}(),s.clone=a.clone,s.fromValues=a.fromValues,s.copy=a.copy,s.set=a.set,s.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.setAxisAngle=function(t,e,n){n=.5*n;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t},s.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return 0!=r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n},s.add=a.add,s.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],l=n[2],c=n[3];return t[0]=r*c+a*s+i*l-o*u,t[1]=i*c+a*u+o*s-r*l,t[2]=o*c+a*l+r*u-i*s,t[3]=a*c-r*s-i*u-o*l,t},s.mul=s.multiply,s.scale=a.scale,s.rotateX=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t},s.rotateY=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t},s.rotateZ=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t},s.calculateW=function(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t},s.dot=a.dot,s.lerp=a.lerp,s.slerp=function(t,e,n,r){var i,o,a,s,u,l=e[0],c=e[1],h=e[2],d=e[3],p=n[0],f=n[1],_=n[2],m=n[3];return o=l*p+c*f+h*_+d*m,0>o&&(o=-o,p=-p,f=-f,_=-_,m=-m),1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*l+u*p,t[1]=s*c+u*f,t[2]=s*h+u*_,t[3]=s*d+u*m,t},s.sqlerp=function(){var t=s.create(),e=s.create();return function(n,r,i,o,a,u){return s.slerp(t,r,a,u),s.slerp(e,i,o,u),s.slerp(n,t,e,2*u*(1-u)),n}}(),s.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t},s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.length=a.length,s.len=s.length,s.squaredLength=a.squaredLength,s.sqrLen=s.squaredLength,s.normalize=a.normalize,s.fromMat3=function(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t},s.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},s.exactEquals=a.exactEquals,s.equals=a.equals,e.exports=s},{"./common.js":24,"./mat3.js":27,"./vec3.js":31,"./vec4.js":32}],30:[function(t,e,n){var r=t("./common.js"),i={};i.create=function(){var t=new r.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},i.clone=function(t){var e=new r.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},i.fromValues=function(t,e){var n=new r.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},i.set=function(t,e,n){return t[0]=e,t[1]=n,t},i.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},i.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},i.sub=i.subtract,i.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},i.mul=i.multiply,i.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},i.div=i.divide,i.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},i.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},i.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},i.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},i.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},i.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},i.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},i.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},i.dist=i.distance,i.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},i.sqrDist=i.squaredDistance,i.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},i.len=i.length,i.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},i.sqrLen=i.squaredLength,i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},i.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},i.normalize=function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},i.cross=function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t},i.lerp=function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t},i.random=function(t,e){e=e||1;var n=2*r.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},i.transformMat2=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t},i.transformMat2d=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t},i.transformMat3=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t},i.transformMat4=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t},i.forEach=function(){var t=i.create();return function(e,n,r,i,o,a){var s,u;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;u>s;s+=n)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),i.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},i.equals=function(t,e){var n=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(n-o)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))},e.exports=i},{"./common.js":24}],31:[function(t,e,n){var r=t("./common.js"),i={};i.create=function(){var t=new r.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},i.clone=function(t){var e=new r.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.fromValues=function(t,e,n){var i=new r.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=n,i},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},i.set=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},i.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},i.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},i.sub=i.subtract,i.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},i.mul=i.multiply,i.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},i.div=i.divide,i.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},i.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},i.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},i.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},i.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},i.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},i.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},i.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)},i.dist=i.distance,i.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i},i.sqrDist=i.squaredDistance,i.length=function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)},i.len=i.length,i.squaredLength=function(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r},i.sqrLen=i.squaredLength,i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},i.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},i.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},i.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},i.lerp=function(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t},i.hermite=function(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t},i.bezier=function(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,d=u*o;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*d,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*d,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*d,t},i.random=function(t,e){e=e||1;var n=2*r.RANDOM()*Math.PI,i=2*r.RANDOM()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=i*e,t},i.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t},i.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},i.transformQuat=function(t,e,n){
var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*o-u*i,h=l*i+u*r-a*o,d=l*o+a*i-s*r,p=-a*r-s*i-u*o;return t[0]=c*l+p*-a+h*-u-d*-s,t[1]=h*l+p*-s+d*-a-c*-u,t[2]=d*l+p*-u+c*-s-h*-a,t},i.rotateX=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},i.rotateY=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},i.rotateZ=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},i.forEach=function(){var t=i.create();return function(e,n,r,i,o,a){var s,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;u>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),i.angle=function(t,e){var n=i.fromValues(t[0],t[1],t[2]),r=i.fromValues(e[0],e[1],e[2]);i.normalize(n,n),i.normalize(r,r);var o=i.dot(n,r);return o>1?0:Math.acos(o)},i.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},i.equals=function(t,e){var n=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(n-a)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},e.exports=i},{"./common.js":24}],32:[function(t,e,n){var r=t("./common.js"),i={};i.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},i.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},i.fromValues=function(t,e,n,i){var o=new r.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=i,o},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},i.set=function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},i.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},i.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},i.sub=i.subtract,i.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},i.mul=i.multiply,i.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},i.div=i.divide,i.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},i.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},i.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},i.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},i.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},i.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},i.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},i.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(n*n+r*r+i*i+o*o)},i.dist=i.distance,i.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o},i.sqrDist=i.squaredDistance,i.length=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)},i.len=i.length,i.squaredLength=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i},i.sqrLen=i.squaredLength,i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},i.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},i.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},i.lerp=function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t},i.random=function(t,e){return e=e||1,t[0]=r.RANDOM(),t[1]=r.RANDOM(),t[2]=r.RANDOM(),t[3]=r.RANDOM(),i.normalize(t,t),i.scale(t,t,e),t},i.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t},i.transformQuat=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*o-u*i,h=l*i+u*r-a*o,d=l*o+a*i-s*r,p=-a*r-s*i-u*o;return t[0]=c*l+p*-a+h*-u-d*-s,t[1]=h*l+p*-s+d*-a-c*-u,t[2]=d*l+p*-u+c*-s-h*-a,t[3]=e[3],t},i.forEach=function(){var t=i.create();return function(e,n,r,i,o,a){var s,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;u>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),i.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},i.equals=function(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=e[0],u=e[1],l=e[2],c=e[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-c)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))},e.exports=i},{"./common.js":24}],33:[function(t,e,n){(function(t){WebGLDebugUtils=function(){function e(t){if(null==f){f={},_={};for(var e in t)"number"==typeof t[e]&&(f[t[e]]=e,_[e]=t[e])}}function n(){if(null==f)throw"WebGLDebugUtils.init(ctx) not called"}function r(t){return n(),void 0!==f[t]}function i(t){n();var e=f[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function o(t,e,n,r){var o=p[t];if(void 0!==o){var o=o[e];if(void 0!==o&&o[n]){if("object"==typeof o[n]&&void 0!==o[n].enumBitwiseOr){for(var a=o[n].enumBitwiseOr,s=0,u=[],l=0;l<a.length;++l){var c=_[a[l]];0!==(r&c)&&(s|=c,u.push(i(c)))}return s===r?u.join(" | "):i(r)}return i(r)}}return null===r?"null":void 0===r?"undefined":r.toString()}function a(t,e){for(var n="",r=e.length,i=0;r>i;++i)n+=(0==i?"":", ")+o(t,r,i,e[i]);return n}function s(t,e,n){t.__defineGetter__(n,function(){return e[n]}),t.__defineSetter__(n,function(t){e[n]=t})}function u(t,n,r,a){function l(t,e){return function(){r&&r(e,arguments);var i=t[e].apply(t,arguments),o=a.getError();return 0!=o&&(c[o]=!0,n(o,e,arguments)),i}}a=a||t,e(t),n=n||function(t,e,n){for(var r="",a=n.length,s=0;a>s;++s)r+=(0==s?"":", ")+o(e,a,s,n[s]);d("WebGL error "+i(t)+" in "+e+"("+r+")")};var c={},h={};for(var p in t)if("function"==typeof t[p])if("getExtension"!=p)h[p]=l(t,p);else{var f=l(t,p);h[p]=function(){var e=f.apply(t,arguments);return u(e,n,r,a)}}else s(h,t,p);return h.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return t.NO_ERROR},h}function l(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);for(var r=0;e>r;++r)t.disableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(r,0);t.deleteBuffer(n);for(var i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),r=0;i>r;++r)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function c(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function n(t){var e=t.addEventListener;t.addEventListener=function(n,r,i){switch(n){case"webglcontextlost":w(r);break;case"webglcontextrestored":S(r);break;default:e.apply(t,arguments)}}}function r(){for(var t=Object.keys(M),e=0;e<t.length;++e)delete M[t]}function i(){++y,m||v==y&&t.loseContext()}function o(t,e){var n=t[e];return function(){if(i(),!m){var e=n.apply(t,arguments);return e}}}function a(){for(var t=0;t<g.length;++t){var e=g[t];e instanceof WebGLBuffer?h.deleteBuffer(e):e instanceof WebGLFramebuffer?h.deleteFramebuffer(e):e instanceof WebGLProgram?h.deleteProgram(e):e instanceof WebGLRenderbuffer?h.deleteRenderbuffer(e):e instanceof WebGLShader?h.deleteShader(e):e instanceof WebGLTexture&&h.deleteTexture(e)}}function u(t){return{statusMessage:t,preventDefault:function(){b=!0}}}function c(t){for(var e in t)"function"==typeof t[e]?d[e]=o(t,e):s(d,t,e);d.getError=function(){if(i(),!m)for(var t;t=h.getError();)M[t]=!0;for(var t in M)if(M[t])return delete M[t],t;return d.NO_ERROR};for(var n=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],r=0;r<n.length;++r){var a=n[r];d[a]=function(e){return function(){if(i(),m)return null;var n=e.apply(t,arguments);return n.__webglDebugContextLostId__=_,g.push(n),n}}(t[a])}for(var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],r=0;r<u.length;++r){var a=u[r];d[a]=function(e){return function(){return i(),m?null:e.apply(t,arguments)}}(d[a])}for(var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],r=0;r<l.length;++r){var a=l[r];d[a]=function(e){return function(){return i(),m?!1:e.apply(t,arguments)}}(d[a])}return d.checkFramebufferStatus=function(e){return function(){return i(),m?d.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(e){return function(){return i(),m?-1:e.apply(t,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(e){return function(){return i(),m?0:e.apply(t,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return m},d}var h,d,p=[],f=[],d={},_=1,m=!1,g=[],v=0,y=0,b=!1,x=0,M={};t.getContext=function(e){return function(){var n=e.apply(t,arguments);if(n instanceof WebGLRenderingContext){if(n!=h){if(h)throw"got different context";h=n,d=c(h)}return d}return n}}(t.getContext);var w=function(t){p.push(e(t))},S=function(t){f.push(e(t))};return n(t),t.loseContext=function(){if(!m){for(m=!0,v=0,++_;h.getError(););r(),M[h.CONTEXT_LOST_WEBGL]=!0;var e=u("context lost"),n=p.slice();setTimeout(function(){for(var r=0;r<n.length;++r)n[r](e);x>=0&&setTimeout(function(){t.restoreContext()},x)},0)}},t.restoreContext=function(){m&&f.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";a(),l(h),m=!1,y=0,b=!1;for(var t=f.slice(),e=u("context restored"),n=0;n<t.length;++n)t[n](e)},0)},t.loseContextInNCalls=function(t){if(m)throw"You can not ask a lost contet to be lost";v=y+t},t.getNumCalls=function(){return y},t.setRestoreTimeout=function(t){x=t},t}"undefined"==typeof window&&(window=t);var h=function(t){window.console&&window.console.log&&window.console.log(t)},d=function(t){window.console&&window.console.error?window.console.error(t):h(t)},p={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},f=null,_=null;return{init:e,mightBeEnum:r,glEnumToString:i,glFunctionArgToString:o,glFunctionArgsToString:a,makeDebugContext:u,makeLostContextSimulatingCanvas:c,resetToInitialState:l}}(),e.exports=WebGLDebugUtils}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(t,e,n){"use strict";var r=t("../util"),i=100,o=0,a=function(t){this.scene=t,this.core=t.core,this.parent=null,this.id=++o,this.frame_count=0,this._x=0,this._y=0,this._auto_disable_times_map={},this._velocity=null,this.resetVelocity(),this._previous_x=null,this._previous_y=null,this.objects=[]};r.defineProperty(a,"x"),r.defineProperty(a,"y"),a.prototype.init=function(){this.frame_count=0,this._auto_disable_times_map={},this.resetVelocity(),this._previous_x=null,this._previous_y=null;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},a.prototype.beforeDraw=function(){this.frame_count++,this._checkAutoDisableFlags();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this._move()},a.prototype.draw=function(){this.core.debug_manager.isShowingCollisionArea()&&this._drawCollisionArea("white");for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw()},a.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw()},a.prototype.width=function(){return 0},a.prototype.height=function(){return 0},a.prototype.setPosition=function(t,e){this._x=t,this._y=e},a.prototype.root=function(){return this.parent?this.parent.root():this},a.prototype.globalCenterX=function(){return this.scene.x()+this.x()},a.prototype.globalCenterY=function(){return this.scene.y()+this.y()},a.prototype.globalLeftX=function(){return this.scene.x()+this.x()-this.width()/2},a.prototype.globalRightX=function(){return this.scene.x()+this.x()+this.width()/2},a.prototype.globalUpY=function(){return this.scene.y()+this.y()-this.height()/2},a.prototype.globalDownY=function(){return this.scene.y()+this.y()+this.height()/2},a.prototype.addSubObject=function(t){t.setParent(this),this.objects.push(t)},a.prototype.addSubObjects=function(t){for(var e=0,n=t.length;n>e;e++){var r=t[e];r.setParent(this)}this.objects=this.objects.concat(t)},a.prototype.removeSubObject=function(t){for(var e=0,n=this.objects.length;n>e;e++)if(this.objects[e].id===t.id){this.objects[e].resetParent(),this.objects.splice(e,1);break}},a.prototype.removeAllSubObject=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].resetParent();this.objects=[]},a.prototype.setParent=function(t){if(this.parent)throw new Error("already set parent");this.parent=t},a.prototype.resetParent=function(){this.parent=null},a.prototype.collisionWidth=function(t){return 0},a.prototype.collisionHeight=function(t){return 0},a.prototype.onCollision=function(t){},a.prototype.isCollision=function(t){return!0},a.prototype.checkCollisionWithObject=function(t){var e=this,n=t.intersect(e);return n&&(t.onCollision(e),e.onCollision(t)),n},a.prototype.checkCollisionWithObjects=function(t){for(var e=this,n=!1,r=0;r<t.length;r++){var i=t[r];e.checkCollisionByObject(i)&&(e.onCollision(i),i.onCollision(e),n=!0)}return n},a.prototype.checkCollisionWithPosition=function(t,e){var n=new s(this.scene);return n.init(),n.setPosition(t,e),this.checkCollisionWithObject(n)},a.prototype.intersect=function(t){return this.isCollision(t)&&t.isCollision(this)&&Math.abs(this.collisionX()-t.collisionX())<this.collisionWidth(t)/2+t.collisionWidth(this)/2&&Math.abs(this.collisionY()-t.collisionY())<this.collisionHeight(t)/2+t.collisionHeight(this)/2?!0:!1},a.prototype.collisionX=function(){return this.x()},a.prototype.collisionY=function(){return this.y()},a.prototype.getCollisionLeftX=function(t){return this.collisionX()-this.collisionWidth(t)/2},a.prototype.getCollisionRightX=function(t){return this.collisionX()+this.collisionWidth(t)/2},a.prototype.getCollisionUpY=function(t){return this.collisionY()-this.collisionHeight(t)/2},a.prototype.getCollisionDownY=function(t){return this.collisionY()+this.collisionHeight(t)/2},a.prototype._drawCollisionArea=function(t){var e=new a(this.scene);if(this.isCollision(e)){t=t||"rgb( 255, 255, 255 )";var n=this.core.ctx;n.save(),n.fillStyle=t,n.globalAlpha=.4,n.fillRect(this.getCollisionLeftX(e),this.getCollisionUpY(e),this.collisionWidth(e),this.collisionHeight(e)),n.restore()}},a.prototype.checkCollision=function(t){return this.checkCollisionByObject(t)},a.prototype.checkCollisionByObject=function(t){return this.intersect(t)},a.prototype.setAutoDisableFlag=function(t,e){var n=this;n[t]=!0,n._auto_disable_times_map[t]=n.frame_count+e},a.prototype._checkAutoDisableFlags=function(){var t=this;for(var e in t._auto_disable_times_map)this._auto_disable_times_map[e]<t.frame_count&&(t[e]=!1,delete t._auto_disable_times_map[e])},a.prototype.setVelocity=function(t){this._velocity=t},a.prototype.resetVelocity=function(){this._velocity={magnitude:0,theta:0}},a.prototype.setVelocityMagnitude=function(t){this._velocity.magnitude=t},a.prototype.setVelocityTheta=function(t){this._velocity.theta=t},a.prototype._move=function(){var t=r.calcMoveXByVelocity(this._velocity),e=r.calcMoveYByVelocity(this._velocity);this._previous_x=this._x,this._previous_y=this._y,this._x+=t,this._y+=e},a.prototype.moveBack=function(){if(null!==this._previous_x||!this._previous_y){var t=this._x,e=this._y;this._x=this._previous_x,this._y=this._previous_y,this._previous_x=t,this._previous_y=e}},a.prototype.isOutOfStage=function(){return this.x()+i<0||this.y()+i<0||this.x()>this.core.width+i||this.y()>this.core.height+i?!0:!1};var s=function(t){a.apply(this,arguments)};r.inherit(s,a),s.prototype.collisionWidth=function(){return 1},s.prototype.collisionHeight=function(){return 1},s.prototype.width=function(){return 1},s.prototype.height=function(){return 1},e.exports={object_base:a,object_point:s}},{"../util":56}],35:[function(t,e,n){"use strict";var r=t("./_base_and_point_classes");e.exports=r.object_base},{"./_base_and_point_classes":34}],36:[function(t,e,n){"use strict";var r=t("./_base_and_point_classes");e.exports=r.object_point},{"./_base_and_point_classes":34}],37:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=function(t,e){r.apply(this,arguments),this.Class=e,this.objects={}};i.inherit(o,r),o.prototype.init=function(){r.prototype.init.apply(this,arguments),this.objects={}},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw()},o.prototype.draw=function(){r.prototype.draw.apply(this,arguments);for(var t in this.objects)this.objects[t].draw()},o.prototype.afterDraw=function(){r.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},o.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},o.prototype.remove=function(t){delete this.objects[t]},o.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var n=this.objects[e];t.checkCollision(n)&&(t.onCollision(n),n.onCollision(t))}},o.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var n in t.objects)if(this.objects[e].checkCollision(t.objects[n])){var r=this.objects[e],i=t.objects[n];if(r.onCollision(i),i.onCollision(r),!this.objects[e])break}},o.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},e.exports=o},{"../util":56,"./base":35}],38:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=t("gl-matrix"),a=t("../constant/webgl").SPRITE3D,s=function(t,e){r.apply(this,arguments),this.Class=e,this.objects={},this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[];var n=this.core.gl;this.vBuffer=n.createBuffer(),this.cBuffer=n.createBuffer(),this.iBuffer=n.createBuffer(),this.aBuffer=n.createBuffer(),this.mvMatrix=o.mat4.create(),this.pMatrix=o.mat4.create()};i.inherit(s,r),s.prototype.init=function(){r.prototype.init.apply(this,arguments),this.objects={},this._initmvpMatrix()},s.prototype._initmvpMatrix=function(){o.mat4.identity(this.mvMatrix),o.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},s.prototype._setOrthographicProjection=function(){o.mat4.identity(this.pMatrix);var t=.1,e=10;o.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,t,e)},s.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw();this._updateAttributes()},s.prototype._updateAttributes=function(){this._resetAttributes();var t=0;for(var e in this.objects){var n=this.objects[e];if(n.isShow()){var r;for(r=0;r<a.V_SIZE;r++)this.vertices[t*a.V_SIZE+r]=n.vertices[r];for(r=0;r<a.C_SIZE;r++)this.coordinates[t*a.C_SIZE+r]=n.coordinates[r];for(r=0;r<a.I_SIZE;r++)this.indices[t*a.I_SIZE+r]=t*a.V_ITEM_NUM+n.indices[r];for(r=0;r<a.A_SIZE;r++)this.colors[t*a.A_SIZE+r]=n.colors[r];t++}}},s.prototype._resetAttributes=function(){this.vertices.length=0,this.coordinates.length=0,this.indices.length=0,this.colors.length=0},s.prototype.draw=function(){if(r.prototype.draw.apply(this,arguments),0!==this.vertices.length){var t=this.core.gl,e=this.shader();t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),a.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),a.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),a.A_ITEM_SIZE);for(var n in this.objects){var i=this.objects[n].texture;this._setupTexture("uSampler",0,i);break}t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}},s.prototype._setupAttribute=function(t,e,n,r){var i=this.core.gl,o=this.shader();i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,n,i.STATIC_DRAW),i.enableVertexAttribArray(o.attribute_locations[t]),i.vertexAttribPointer(o.attribute_locations[t],r,i.FLOAT,!1,0,0)},s.prototype._setupTexture=function(t,e,n){var r=this.core.gl,i=this.shader();r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,n),r.uniform1i(i.uniform_locations[t],e)},s.prototype.afterDraw=function(){r.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},s.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},s.prototype.remove=function(t){delete this.objects[t]},s.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var n=this.objects[e];t.checkCollision(n)&&(t.onCollision(n),n.onCollision(t))}},s.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var n in t.objects)if(this.objects[e].checkCollision(t.objects[n])){var r=this.objects[e],i=t.objects[n];if(r.onCollision(i),i.onCollision(r),!this.objects[e])break}},s.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},s.prototype.shader=function(){return this.core.sprite_3d_shader},e.exports=s},{"../constant/webgl":11,"../util":56,"./base":35,"gl-matrix":23}],39:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=function(t){r.apply(this,arguments),this.current_sprite_index=0};i.inherit(o,r),o.prototype.init=function(){r.prototype.init.apply(this,arguments),this.current_sprite_index=0},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},o.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var n=i.thetaToRadian(this._velocity.theta+this.rotateAdjust());e.rotate(n);var o=this.spriteWidth(),a=this.spriteHeight();o||(o=t.width),a||(a=t.height);var s=this.width(),u=this.height();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.globalAlpha=this.alpha(),e.drawImage(t,o*this.spriteIndexX(),a*this.spriteIndexY(),o,a,-s/2,-u/2,s,u),e.restore()}r.prototype.draw.apply(this,arguments)},o.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},o.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},o.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},o.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},o.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},o.prototype.isShow=function(){return!0},o.prototype.spriteAnimationSpan=function(){return 0},o.prototype.spriteIndices=function(){return[{x:0,y:0}]},o.prototype.spriteWidth=function(){return 0},o.prototype.spriteHeight=function(){return 0},o.prototype.rotateAdjust=function(){return 0},o.prototype.scale=function(){return 0},o.prototype.scaleWidth=function(){return 1},o.prototype.scaleHeight=function(){return 1},o.prototype.isReflect=function(){return!1},o.prototype.alpha=function(){return 1},e.exports=o},{"../util":56,"./base":35}],40:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=t("../constant/webgl").SPRITE3D,a=t("gl-matrix"),s=function(t){r.apply(this,arguments),this.current_sprite_index=0,this._z=0,this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[],this.vertices.length=o.V_SIZE,this.coordinates.length=o.C_SIZE,this.indices.length=o.I_SIZE,this.colors.length=o.A_SIZE;var e=this.core.gl;this.vBuffer=e.createBuffer(),this.cBuffer=e.createBuffer(),this.iBuffer=e.createBuffer(),this.aBuffer=e.createBuffer(),this.texture=null,this.mvMatrix=a.mat4.create(),this.pMatrix=a.mat4.create()};i.inherit(s,r),s.prototype.init=function(){r.prototype.init.apply(this,arguments),this.current_sprite_index=0,this._initmvpMatrix(),this._initVertices(),this._initCoordinates(),this._initIndices(),this._initColors(),this._initTexture()},s.prototype._initmvpMatrix=function(){a.mat4.identity(this.mvMatrix),a.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},s.prototype._initVertices=function(){var t=this.spriteWidth()/2,e=this.spriteHeight()/2;this.vertices[0]=-t,this.vertices[1]=-e,this.vertices[2]=-1,this.vertices[3]=t,this.vertices[4]=-e,this.vertices[5]=-1,this.vertices[6]=t,this.vertices[7]=e,this.vertices[8]=-1,this.vertices[9]=-t,this.vertices[10]=e,this.vertices[11]=-1},s.prototype._initCoordinates=function(){var t=this.core.image_loader.getImage(this.spriteName()),e=this.spriteWidth()/t.width,n=this.spriteHeight()/t.height,r=e*this.spriteIndexX(),i=n*this.spriteIndexY(),o=r+e,a=i+n;this.coordinates[0]=r,this.coordinates[1]=a,this.coordinates[2]=o,this.coordinates[3]=a,this.coordinates[4]=o,this.coordinates[5]=i,this.coordinates[6]=r,this.coordinates[7]=i},s.prototype._initIndices=function(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=2,this.indices[3]=0,this.indices[4]=2,this.indices[5]=3},s.prototype._initColors=function(){this.colors[0]=1,this.colors[1]=1,this.colors[2]=1,this.colors[3]=1,this.colors[4]=1,this.colors[5]=1,this.colors[6]=1,this.colors[7]=1,this.colors[8]=1,this.colors[9]=1,this.colors[10]=1,this.colors[11]=1,this.colors[12]=1,this.colors[13]=1,this.colors[14]=1,this.colors[15]=1},s.prototype._initTexture=function(){var t=this.core.gl,e=this.core.image_loader.getImage(this.spriteName()),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this.texture=n},s.prototype._setOrthographicProjection=function(){a.mat4.identity(this.pMatrix);var t=.1,e=10;a.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,t,e)},s.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0)),this._initVertices(),this._initCoordinates(),this._translate()},s.prototype._translate=function(){for(var t=0;t<o.V_ITEM_NUM;t++)this.vertices[t*o.V_ITEM_SIZE+0]+=this.x(),this.vertices[t*o.V_ITEM_SIZE+1]-=this.y(),this.vertices[t*o.V_ITEM_SIZE+2]+=this.z()},s.prototype._rotate=function(){for(var t=this._getRadian(),e=0;e<o.V_ITEM_NUM;e++){var n=this.vertices[e*o.V_ITEM_SIZE+0],r=this.vertices[e*o.V_ITEM_SIZE+1];this.vertices[e*o.V_ITEM_SIZE+0]=n*Math.cos(t)-r*Math.sin(t),this.vertices[e*o.V_ITEM_SIZE+1]=n*Math.sin(t)+r*Math.cos(t)}},s.prototype._getRadian=function(){var t=this.velocity.theta;return i.thetaToRadian(t)},s.prototype.draw=function(){if(this.isShow()){var t=this.core.gl,e=this.shader();t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),
t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),o.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),o.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),o.A_ITEM_SIZE),this._setupTexture("uSampler",0,this.texture),t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.setupAdditionalVariables(),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}r.prototype.draw.apply(this,arguments)},s.prototype._setupAttribute=function(t,e,n,r){var i=this.core.gl,o=this.shader();i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,n,i.STATIC_DRAW),i.enableVertexAttribArray(o.attribute_locations[t]),i.vertexAttribPointer(o.attribute_locations[t],r,i.FLOAT,!1,0,0)},s.prototype._setupTexture=function(t,e,n){var r=this.core.gl,i=this.shader();r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,n),r.uniform1i(i.uniform_locations[t],e)},s.prototype.z=function(t){return"undefined"!=typeof t&&(this._z=t),this._z},s.prototype.shader=function(){return this.core.sprite_3d_shader},s.prototype.setupAdditionalVariables=function(){},s.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},s.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},s.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},s.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},s.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},s.prototype.isShow=function(){return!0},s.prototype.spriteAnimationSpan=function(){return 0},s.prototype.spriteIndices=function(){return[{x:0,y:0}]},s.prototype.spriteWidth=function(){return 0},s.prototype.spriteHeight=function(){return 0},s.prototype.rotateAdjust=function(){return 0},s.prototype.scaleWidth=function(){return 1},s.prototype.scaleHeight=function(){return 1},s.prototype.isReflect=function(){return!1},e.exports=s},{"../constant/webgl":11,"../util":56,"./base":35,"gl-matrix":23}],41:[function(t,e,n){"use strict";var r=t("../base"),i=t("../../util"),o=function(t,e){r.apply(this,arguments),e=e||{},this._default_property={x:e.x||0,y:e.y||0,children:e.children||[]},this._event_to_callback={beforedraw:function(){}},this.objects=this._default_property.children,this._show_call_count=0};i.inherit(o,r),o.prototype.init=function(){this.objects=this._default_property.children,r.prototype.init.apply(this,arguments),this._show_call_count=0,this.x(this._default_property.x),this.y(this._default_property.y),this.show()},o.prototype.on=function(t,e){return this._event_to_callback[t]=e,this},o.prototype.removeEvent=function(t){return this._event_to_callback[t]=function(){},this},o.prototype._callEvent=function(t){this._event_to_callback[t].apply(this)},o.prototype.isEventSet=function(t){return this._event_to_callback[t]?!0:!1},o.prototype.beforeDraw=function(){if(r.prototype.beforeDraw.apply(this,arguments),this._callEvent("beforedraw"),this.isEventSet("click")&&this.core.input_manager.isLeftClickPush()){var t=this.core.input_manager.mousePositionX(),e=this.core.input_manager.mousePositionY();this.checkCollisionWithPosition(t,e)&&this._callEvent("click")}},o.prototype.draw=function(){r.prototype.draw.apply(this,arguments)},o.prototype.isShow=function(){return this._show_call_count>0},o.prototype.collisionWidth=function(){return this.width()},o.prototype.collisionHeight=function(){return this.height()},o.prototype.show=function(){++this._show_call_count},o.prototype.hide=function(){--this._show_call_count},e.exports=o},{"../../util":56,"../base":35}],42:[function(t,e,n){"use strict";var r=t("./base"),i=t("../../util"),o=function(t,e){r.apply(this,arguments),e=e||{},this._default_property=i.assign(this._default_property,{width:e.width||0,height:e.height||0,backgroundColor:e.backgroundColor||null})};i.inherit(o,r),i.defineProperty(o,"width"),i.defineProperty(o,"height"),i.defineProperty(o,"backgroundColor"),o.prototype.init=function(){r.prototype.init.apply(this,arguments),this.width(this._default_property.width),this.height(this._default_property.height),this.backgroundColor(this._default_property.backgroundColor)},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},o.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx;this.backgroundColor()&&(t.save(),t.translate(this.x(),this.y()),t.fillStyle=this.backgroundColor(),t.fillRect(-this.width()/2,-this.height()/2,this.width(),this.height()),t.restore()),r.prototype.draw.apply(this,arguments)}},e.exports=o},{"../../util":56,"./base":41}],43:[function(t,e,n){"use strict";var r=t("./base"),i=t("../../util"),o=function(t,e){r.apply(this,arguments),e=e||{},this._default_property=i.assign(this._default_property,{image_name:e.image_name||null,scale:e.scale||1,width:e.width||null,height:e.height||null})};i.inherit(o,r),i.defineProperty(o,"image_name"),i.defineProperty(o,"scale"),i.defineProperty(o,"width"),i.defineProperty(o,"height"),o.prototype.init=function(){if(r.prototype.init.apply(this,arguments),this.image_name(this._default_property.image_name),this.scale(this._default_property.scale),this.width(this._default_property.width),this.height(this._default_property.height),!this.width()&&!this.height()){var t=this.core.image_loader.getImage(this.image_name());this.width(t.width*this.scale()),this.height(t.height*this.scale())}},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},o.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.image_name()),e=t.width*this.scale(),n=t.height*this.scale(),i=this.core.ctx;i.save(),i.translate(this.x(),this.y()),i.drawImage(t,-e/2,-n/2,e,n),i.restore(),r.prototype.draw.apply(this,arguments)}},e.exports=o},{"../../util":56,"./base":41}],44:[function(t,e,n){"use strict";var r=16,i=t("./base"),o=t("../../util"),a=function(t,e){i.apply(this,arguments),e=e||{},this._default_property=o.assign(this._default_property,{size:e.size||"",color:e.color||"black"})};o.inherit(a,i),o.defineProperty(a,"size"),o.defineProperty(a,"color"),a.prototype.init=function(){i.prototype.init.apply(this,arguments),this.size(this._default_property.size),this.color(this._default_property.color),this._start=new Date},a.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments)},a.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx,e=Math.floor(this.frame_count/60*r)/r;t.save(),t.translate(this.x(),this.y()),t.rotate(2*Math.PI*e);for(var n=0;r>n;n++)t.beginPath(),t.rotate(2*Math.PI/r),t.moveTo(this.size()/10,0),t.lineTo(this.size()/4,0),t.lineWidth=this.size()/30,t.globalAlpha=n/r,t.strokeStyle=this.color(),t.stroke();t.restore(),i.prototype.draw.apply(this,arguments)}},a.prototype.width=function(){return this.size()/2},a.prototype.height=function(){return this.size()/2},e.exports=a},{"../../util":56,"./base":41}],45:[function(t,e,n){"use strict";var r=t("./base"),i=t("../../util"),o=function(t,e){r.apply(this,arguments),e=e||{},this._default_property=i.assign(this._default_property,{text:e.text||"",textColor:e.textColor||"black",textSize:e.textSize||"24px",textAlign:e.textAlign||"left"})};i.inherit(o,r),i.defineProperty(o,"text"),i.defineProperty(o,"textColor"),i.defineProperty(o,"textSize"),i.defineProperty(o,"textAlign"),o.prototype.init=function(){r.prototype.init.apply(this,arguments),this.text(this._default_property.text),this.textColor(this._default_property.textColor),this.textSize(this._default_property.textSize),this.textAlign(this._default_property.textAlign)},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},o.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx;t.save(),t.fillStyle=this.textColor(),t.textAlign=this.textAlign(),t.font=this.textSize()+" 'sans-serif'",t.fillText(this.text(),this.x(),this.y()),t.restore(),r.prototype.draw.apply(this,arguments)}},e.exports=o},{"../../util":56,"./base":41}],46:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=function(t,e,n,o,a,s){r.apply(this,arguments),this.x(e),this.y(n),this._width=o,this._height=a,this._draw_function=null,"undefined"!=typeof s&&(this._draw_function=i.bind(s,this)),this._is_show_rect=!1,this._collision_callback=null};i.inherit(o,r),o.prototype.onCollision=function(t){this._collision_callback&&this._collision_callback(t)},o.prototype.collisionWidth=function(){return this._width},o.prototype.collisionHeight=function(){return this._height},o.prototype.setShowRect=function(){return this._is_show_rect=!0,this},o.prototype.setVariable=function(t,e){return this[t]=e,this},o.prototype.setCollisionCallback=function(t){this._collision_callback=i.bind(t,this)},o.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),this._draw_function&&this._draw_function(),t.restore(),this._is_show_rect&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore())},e.exports=o},{"../util":56,"./base":35}],47:[function(t,e,n){"use strict";var r=t("../object/base"),i=t("../util"),o=function(t){this.core=t,this.parent=null,this.width=this.core.width,this.height=this.core.height,this._x=0,this._y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this._is_reserved_next_scene_init=!0,this.scenes={},this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null,this._background_color=null,this.ui=new a(this),this.addObject(this.ui)};o.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this._is_reserved_next_scene_init=!0,this._x=0,this._y=0,this.frame_count=0,this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},o.prototype.beforeDraw=function(){this._wait_to_start_bgm_name&&this.frame_count-this._wait_to_start_bgm_start_frame_count>=this._wait_to_start_bgm_duration&&(this.core.audio_loader.playBGM(this._wait_to_start_bgm_name),this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null),this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw(),this.frame_count++},o.prototype.draw=function(){this._drawBackground();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},o.prototype._drawBackground=function(){var t=this.core.ctx;this._background_color&&(t.save(),t.fillStyle=this._background_color,t.fillRect(0,0,this.width,this.height),t.restore())},o.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},o.prototype.addObject=function(t){this.objects.push(t)},o.prototype.addObjects=function(t){this.objects=this.objects.concat(t)},o.prototype.removeAllObject=function(){this.objects=[]},o.prototype.removeObject=function(t){for(var e=0,n=this.objects.length;n>e;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},o.prototype.setParent=function(t){if(this.parent)throw new Error("already set parent");this.parent=t},o.prototype.resetParent=function(){this.parent=null},o.prototype.currentSubScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},o.prototype.getSubScene=function(t){return this.scenes[t]},o.prototype.addSubScene=function(t,e){e.setParent(this),this.scenes[t]=e},o.prototype.changeSubScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t,this._is_reserved_next_scene_init=!0,this.current_scene||this.changeNextSubSceneIfReserved()},o.prototype.returnSubScene=function(t){this._reserved_next_scene=[t],this._is_reserved_next_scene_init=!1},o.prototype.changeNextSubSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentSubScene(),e=this._reserved_next_scene;this._reserved_next_scene=null,this._is_reserved_next_scene_init&&t.init.apply(t,e)}},o.prototype.setWaitToStartBGM=function(t,e){e||(e=0),this._wait_to_start_bgm_name=t,this._wait_to_start_bgm_duration=e,this._wait_to_start_bgm_start_frame_count=this.frame_count},o.prototype.x=function(t){return"undefined"!=typeof t&&(this._x=t),this._x},o.prototype.y=function(t){return"undefined"!=typeof t&&(this._y=t),this._y},o.prototype.root=function(){return this.parent?this.parent.root():this},o.prototype.setBackgroundColor=function(t){this._background_color=t},o.prototype.setFadeIn=function(t,e){return console.error("scene's setFadeIn method is deprecated."),this.core.scene_manager.setFadeIn.apply(this.core.scene_manager,arguments)},o.prototype.isInFadeIn=function(){return console.error("scene's isInFadeIn method is deprecated."),this.core.scene_manager.isInFadeIn.apply(this.core.scene_manager,arguments)},o.prototype.setFadeOut=function(t,e){return console.error("scene's setFadeOut method is deprecated."),this.core.scene_manager.setFadeOut.apply(this.core.scene_manager,arguments)},o.prototype.startFadeOut=function(){return console.error("scene's startFadeOut method is deprecated."),this.core.scene_manager.startFadeOut.apply(this.core.scene_manager,arguments)},o.prototype.isInFadeOut=function(){return console.error("scene's isInFadeOut method is deprecated."),this.core.scene_manager.isInFadeOut.apply(this.core.scene_manager,arguments)},o.prototype.isSetFadeOut=function(){return console.error("scene's isSetFadeOut method is deprecated."),this.core.scene_manager.isSetFadeOut.apply(this.core.scene_manager,arguments)};var a=function(t){r.apply(this,arguments)};i.inherit(a,r),e.exports=o},{"../object/base":35,"../util":56}],48:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=function(t){r.apply(this,arguments),this.next_scene_name=null};i.inherit(o,r),o.prototype.init=function(t,e){r.prototype.init.apply(this,arguments);var n=t.images||[],i=t.sounds||[],o=t.bgms||[],a=t.fonts||[];this.next_scene_name=e;for(var s in n){var u=n[s];"string"==typeof u?this.core.image_loader.loadImage(s,u):this.core.image_loader.loadImage(s,u.path,u.scale_width,u.scale_height)}for(var l in i){var c=i[l];this.core.audio_loader.loadSound(l,c.path,c.volume)}for(var h in o){var d=o[h],p="volume"in d?d.volume:1;this.core.audio_loader.loadBGM(h,d.path,p,d.loopStart,d.loopEnd)}for(var f in a){var _=a[f];this.core.font_loader.loadFont(f,_.path,_.format)}},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.core.isAllLoaded()&&this.notifyAllLoaded()},o.prototype.progress=function(){var t=(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3;return t},o.prototype.draw=function(){r.prototype.draw.apply(this,arguments)},o.prototype.notifyAllLoaded=function(){this.next_scene_name&&this.core.scene_manager.changeScene(this.next_scene_name)},e.exports=o},{"../util":56,"./base":47}],49:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=function(t){r.apply(this,arguments),this.video=null,this.next_scene_name_and_args=null,this.is_playing=!1,this._height=null,this._width=null,this._top=null,this._left=null,this.is_mute=!1};i.inherit(o,r),o.prototype.init=function(t,e,n){r.prototype.init.apply(this,arguments);var i=this,o=Array.prototype.slice.call(arguments);t=o.shift(),n=o,i.is_playing=!1,i._height=null,i._width=null,i._top=null,i._left=null,i.next_scene_name_and_args=null,n.length>0&&(i.next_scene_name_and_args=n),this.core.audio_loader.stopBGM();var a=document.createElement("video");a.src=t,a.controls=!1,a.preload="auto",a.oncanplaythrough=function(){i._calcDrawSizeAndPosition(),a.play(),i.is_playing=!0},this.is_mute&&(a.muted=!0),a.load(),i.video=a},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.is_playing&&this.video.ended&&this.notifyEnd()},o.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx;t&&(t.save(),t.fillStyle="black",t.fillRect(0,0,this.core.width,this.core.height),this.is_playing&&t.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,this._left,this._top,this._width,this._height),t.restore())},o.prototype._calcDrawSizeAndPosition=function(){var t,e,n,r,i=this.width/this.height,o=this.video.videoWidth/this.video.videoHeight;o>=i?(n=this.width,r=this.width/o,e=(this.height-r)/2,t=0):(r=this.height,n=this.height*o,e=0,t=(this.width-n)/2),this._height=r,this._width=n,this._top=e,this._left=t},o.prototype.notifyEnd=function(){this.video=null,this.is_playing=!1,this.next_scene_name_and_args&&this.core.scene_manager.changeScene.apply(this.core.scene_manager,this.next_scene_name_and_args)},e.exports=o},{"../util":56,"./base":47}],50:[function(t,e,n){"use strict";e.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoordinates;\nattribute vec4 aColor;\n\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n	gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n	vTextureCoordinates = aTextureCoordinates;\n	vColor = aColor;\n}\n\n"},{}],51:[function(t,e,n){"use strict";e.exports="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n	vec4 textureColor = texture2D(uSampler, vTextureCoordinates);\n	gl_FragColor = textureColor * vColor;\n}\n\n"},{}],52:[function(t,e,n){"use strict";var r=(t("gl-matrix"),function(t,e,n,r,i){if(!t)throw new Error("arguments 1 must be WebGLRenderingContext instance");this.gl=t;var o,a=this.createShader(t,t.VERTEX_SHADER,e),s=this.createShader(t,t.FRAGMENT_SHADER,n),u=this.createShaderProgram(t,a,s),l={};for(o=0;o<r.length;o++)l[r[o]]=t.getAttribLocation(u,r[o]);var c={};for(o=0;o<i.length;o++)c[i[o]]=t.getUniformLocation(u,i[o]);this.shader_program=u,this.attribute_locations=l,this.uniform_locations=c});r.prototype.createShader=function(t,e,n){if(e!==t.VERTEX_SHADER&&e!==t.FRAGMENT_SHADER)throw new Error("type must be vertex or fragment");var r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw(e===t.VERTEX_SHADER?"Vertex":"Fragment")+" failed to compile:\n\n"+t.getShaderInfoLog(r);return r},r.prototype.createShaderProgram=function(t,e,n){var r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error("Could not initialize shaders:\n\n"+t.getProgramInfoLog(r));return r},e.exports=r},{"gl-matrix":23}],53:[function(t,e,n){"use strict";var r=t("../util"),i=function(t){t||(t={}),this._data=t};i.KEY=function(){throw new Error("KEY method must be overridden.")},i.localFileDirectory=function(){return"save"},i.prototype.set=function(t,e){this._data[t]=e},i.prototype.get=function(t){return this._data[t]},i.prototype.exists=function(t){return t in this._data},i.prototype.remove=function(t){return delete this._data[t]},i.prototype.isEmpty=function(){return 0===Object.keys(this._data).length},i.prototype.toHash=function(){return r.shallowCopyHash(this._data)},i.isLocalMode=function(){return r.isElectron()?!0:!1},i.prototype.save=function(){var t=this.constructor;t.isLocalMode()?this._saveToLocalFile():this._saveToWebStorage()},i.prototype._saveToLocalFile=function(){var t=this.constructor,e=window.require("fs"),n=JSON.stringify(this._data),r=t._localFileDirectoryPath(),i=r+t._localFileName(t.KEY());e.existsSync(r)||e.mkdirSync(r),e.writeFileSync(i,n)},i._localFileDirectoryPath=function(){var t=window.require("path"),e=window.require("electron").remote.app,n=e.getPath("appData"),r=e.getName();return t.join(n,r,this.localFileDirectory())},i._localFileName=function(t){return t+".json"},i._localFilePath=function(t){return this._localFileDirectoryPath()+this._localFileName(t)},i.prototype._saveToWebStorage=function(){var t=this.constructor,e=t.KEY(),n=JSON.stringify(this._data);try{window.localStorage.setItem(e,n)}catch(r){}},i.prototype.reload=function(){var t,e=this.constructor;t=e.isLocalMode()?e._loadFromLocalFile():e._loadFromWebStorage(),this._data=t},i.load=function(){var t;t=this.isLocalMode()?this._loadFromLocalFile():this._loadFromWebStorage();var e=this;return t?new e(t):new e},i._loadFromLocalFile=function(){var t=window.require("fs"),e=this._localFilePath(this.KEY());if(!t.existsSync(e))return null;var n=t.readFileSync(e,{encoding:"utf8"});return n?JSON.parse(n):null},i._loadFromWebStorage=function(){var t,e=this.KEY();try{t=window.localStorage.getItem(e)}catch(n){}return t?JSON.parse(t):null},i.prototype.del=function(){var t=this.constructor;t.isLocalMode()?this._removeLocalFile():this._removeWebStorage(),this._data={}},i.prototype._removeLocalFile=function(){var t=this.constructor,e=window.require("fs"),n=t._localFilePath(t.KEY());e.existsSync(n)&&e.unlinkSync(n)},i.prototype._removeWebStorage=function(){var t=this.constructor,e=t.KEY();try{window.localStorage.removeItem(e)}catch(n){}},e.exports=i},{"../util":56}],54:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=function(t){r.apply(this,arguments)};i.inherit(o,r);var a="hakurei_engine",s="save";o.KEY=function(){return!this.isLocalMode()&&window&&window.location?[a,s,window.location.pathname].join(":"):s},e.exports=o},{"../util":56,"./base":53}],55:[function(t,e,n){"use strict";var r=t("./base"),i=t("../util"),o=function(t){r.apply(this,arguments)};i.inherit(o,r);var a="hakurei_engine",s="scenario";o.KEY=function(){return!this.isLocalMode()&&window&&window.location?[a,s,window.location.pathname].join(":"):s},o.prototype.getSerifStatus=function(t){var e=this.get(t);return e||(e={}),e},o.prototype.getPlayedCount=function(t){var e=this.getSerifStatus(t);return e.played_count||0},o.prototype.incrementPlayedCount=function(t){var e=this.getSerifStatus(t);e.played_count=e.played_count||0,e.played_count++,this.set(t,e)},e.exports=o},{"../util":56,"./base":53}],56:[function(t,e,n){"use strict";var r={inherit:function(t,e){var n=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=n(e.prototype),t.prototype.constructor=t;for(var r in e)t[r]=e[r]},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(r.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(r.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t,n=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16);return"rgb("+n+", "+r+", "+i+")"},clamp:function(t,e,n){return e>t?e:t>n?n:t},isElectron:function(){return"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?!0:!1},canPlayOgg:function(){var t=document.createElement("audio");return t.canPlayType?t.canPlayType("audio/ogg"):!1},getRandomInt:function(t,e){return 1===arguments.length&&(e=arguments[0],t=1),Math.floor(Math.random()*(e-t+1))+t},downloadBlob:function(t,e){var n=window.URL||window.webkitURL,r=n.createObjectURL(t),i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var o=document.createElementNS("http://www.w3.org/1999/xhtml","a");o.href=r,o.download=e,o.dispatchEvent(i)},shallowCopyHash:function(t){var e={};for(var n in t)e[n]=t[n];return e},assign:function(t,e){if(!t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var i=arguments[r];if(i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},bind:function(t,e){if("function"!=typeof t)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=Array.prototype.slice.call(arguments,1),r=t,i=function(){},o=function(){return r.apply(t instanceof i?t:e,n.concat(Array.prototype.slice.call(arguments)))};return t.prototype&&(i.prototype=t.prototype),o.prototype=new i,o},defineProperty:function(t,e){var n="_"+e;t.prototype[e]=function(t){return"undefined"!=typeof t&&(this[n]=t),this[n]}}};e.exports=r},{}],57:[function(t,e,n){"use strict";var r=function(){};r.exec=function(t,e){if("undefined"==typeof e)return t;var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");return r.globalAlpha=e,r.fillStyle="rgb( 0, 0, 0 )",r.fillRect(0,0,t.width,t.height),r.globalCompositeOperation="destination-atop",r.globalAlpha=1,r.drawImage(t,0,0,t.width,t.height),n},e.exports=r},{}],58:[function(t,e,n){"use strict";var r=t("../hakurei").util,i=t("../hakurei").scene.base,o=function(t){i.apply(this,arguments)};r.inherit(o,i),o.prototype.init=function(){i.prototype.init.apply(this,arguments),this.core.scene_manager.setFadeIn(60,"black")},o.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments)},o.prototype.draw=function(){i.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),t.fillStyle="black",t.fillRect(0,0,this.width,this.height),t.fillStyle="white",t.font="36px 'Migu'",t.textAlign="center",t.textBaseAlign="middle",t.fillText("END",this.width/2,this.height/2),t.restore()},e.exports=o},{"../hakurei":6}],59:[function(t,e,n){"use strict";var r=t("../hakurei").scene.loading,i=t("../hakurei").util,o=t("../config/assets"),a=function(t){r.apply(this,arguments)};i.inherit(a,r),a.prototype.init=function(){r.prototype.init.apply(this,[o,"talk"])},a.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),t.fillStyle="black",t.fillRect(0,0,this.core.width,this.core.height),t.restore();var e=this.frame_count%60,n=15,i="";i=n>e&&e>=0?"":2*n>e&&e>=1*n?".":3*n>e&&e>=2*n?"..":"...",t.save(),t.fillStyle="white",t.textAlign="left",t.font="30px 'OradanoGSRR'",t.fillText("Now Loading"+i,this.core.width-250,this.core.height-50),t.restore(),t.save(),t.fillStyle="white",t.fillRect(0,this.core.height-20,this.core.width*this.progress(),50),t.restore()},e.exports=a},{"../config/assets":1,"../hakurei":6}],60:[function(t,e,n){"use strict";var r=10,i=5,o=.5,a=100,s=100,u="left",l="right",c=t("../hakurei").util,h=t("../hakurei").scene.base,d=t("../hakurei").serif_manager,p=t("../logic/create_darker_image"),f=function(t){h.apply(this,arguments),this.serif=new d};c.inherit(f,h),f.prototype.init=function(){h.prototype.init.apply(this,arguments),this.serif.init(this.core.serif),this.serif.start(),this.transition_count=0,this.core.audio_loader.stopBGM(),this._afterSerifChanged()},f.prototype.beforeDraw=function(){h.prototype.beforeDraw.apply(this,arguments),this.isInTransition()&&(this.transition_count--,0===this.transition_count&&this.serif.resumePrintLetter()),this.core.input_manager.isLeftClickPush()&&(this.serif.isEnd()?this.notifySerifEnd():this.isInTransition()?(this.transition_count=0,this.serif.resumePrintLetter()):(this.serif.next(),this.serif.isBackgroundChanged()&&(this.transition_count=a,this.serif.pausePrintLetter()),this._afterSerifChanged()))},f.prototype.draw=function(){h.prototype.draw.apply(this,arguments);var t=this.core.ctx;this.isInTransition()?(t.fillStyle="white",t.fillRect(0,0,this.width,this.height),t.globalAlpha=(a-this.transition_count)/a,this._showBackground(),t.globalAlpha=1):(this._showBackground(),this.serif.getCurrentCharaNameByPosition(l)&&this._showRightChara(),this.serif.getCurrentCharaNameByPosition(u)&&this._showLeftChara(),this._showMessageWindow(),this._showMessage())},f.prototype._showBackground=function(){var t=this.core.ctx,e=this.serif.getCurrentBackgroundImageName();if(e){var n,r,i,o,a=this.core.image_loader.getImage(e),s=a.width,u=a.height,l=this.width/this.height,c=s/u;c>=l?(i=this.width,o=this.width/c,r=(this.height-o)/2,n=0):(o=this.height,i=this.height*c,r=0,n=(this.width-i)/2),t.drawImage(a,n,r,i,o)}},f.prototype._showRightChara=function(){var t=this.core.ctx;t.save();var e=350,n=65,r=this.core.image_loader.getImage(this.serif.getCurrentCharaNameByPosition(l)+"_"+this.serif.getCurrentCharaExpressionByPosition(l));this.serif.isCurrentTalkingByPosition(l)?(e-=i,n-=i):r=p.exec(r,.5),t.drawImage(r,e,n,r.width*o,r.height*o),t.restore()},f.prototype._showLeftChara=function(){var t=this.core.ctx;t.save();var e=-50,n=85,r=this.core.image_loader.getImage(this.serif.getCurrentCharaNameByPosition(u)+"_"+this.serif.getCurrentCharaExpressionByPosition(u));this.serif.isCurrentTalkingByPosition(u)?(e+=i,n-=i):r=p.exec(r,.5),t.drawImage(r,e,n,r.width*o,r.height*o),t.restore()},f.prototype._showMessageWindow=function(){var t=this.core.ctx;t.save(),t.globalAlpha=.5,t.fillStyle="rgb( 0, 0, 0 )",t.fillRect(r,this.height-125,this.width-2*r,s),t.restore()},f.prototype._showMessage=function(){var t=this.core.ctx;t.save();var e=this.serif.getCurrentOption().font_color;e=e?c.hexToRGBString(e):"rgb(255, 255, 255)",t.font="18px 'Migu'",t.textAlign="left",t.textBaseAlign="middle";var n,i=this.serif.getCurrentPrintedSentences();if(i.length){n=this.height-125+40;for(var o=0,a=i.length;a>o;o++)t.fillStyle="rgb( 0, 0, 0 )",t.lineWidth=4,t.strokeText(i[o],2*r+20,n),t.fillStyle=e,t.fillText(i[o],2*r+20,n),n+=30}t.restore()},f.prototype._afterSerifChanged=function(){for(;!this.serif.isEnd()&&0===this.serif.getCurrentMaxLengthLetters();)this.serif.getCurrentOption().bgm&&this.core.audio_loader.playBGM(this.serif.getCurrentOption().bgm),this.serif.next()},f.prototype.notifySerifEnd=function(){this.core.scene_manager.setFadeOut(60),this.core.scene_manager.changeScene("end")},f.prototype.isInTransition=function(){return this.transition_count?!0:!1},e.exports=f},{"../hakurei":6,"../logic/create_darker_image":57}],61:[function(t,e,n){"use strict";var r=t("mithril"),i=t("./mithril/component/new.js"),o=t("./mithril/component/edit.js"),a=t("./mithril/component/show.js");r.route.mode="pathname",r.route(document.getElementById("root"),"/novel/new",{"/novel/new":i,"/novel/show/:id":a,"/novel/edit/:id":o})},{"./mithril/component/edit.js":62,"./mithril/component/new.js":63,"./mithril/component/show.js":64,mithril:75}],62:[function(t,e,n){"use strict";var r=t("../controller/edit"),i=t("../view/common");e.exports={controller:r,view:i}},{"../controller/edit":67,"../view/common":73}],63:[function(t,e,n){"use strict";var r=t("../controller/new"),i=t("../view/common");e.exports={controller:r,view:i}},{"../controller/new":68,"../view/common":73}],64:[function(t,e,n){"use strict";var r=t("../controller/show"),i=t("../view/common");e.exports={controller:r,view:i}},{"../controller/show":69,"../view/common":73}],65:[function(t,e,n){"use strict";var r=t("../vdom/background"),i=t("../vdom/bgm"),o=t("../vdom/serif");e.exports=[{name:"セリフ",value:"serif",Klass:o},{name:"背景変更",value:"background",Klass:r},{name:"BGM変更",value:"bgm",Klass:i}]},{"../vdom/background":70,"../vdom/bgm":71,"../vdom/serif":72}],66:[function(t,e,n){"use strict";var r=t("../../game/game"),i=t("../vm/common"),o=function(t){this.game=null,this.vm=new i,this.load()};o.prototype.reload=function(){this.game.setSerif(this.vm.toGameData()),this.game.reload()},o.prototype.togglePrivate=function(){this.vm.togglePrivate()},o.prototype.runGame=function(t,e,n){if(!e){var i=new r(t);i.setupEvents(),window.onkeydown=function(t){},window.onkeyup=function(t){},i.init(),i.startRun(),this.game=i,this.game.setSerif(this.vm.toGameData())}},o.prototype["delete"]=function(t){for(var e=0,n=this.vm.vdom.length;n>e;e++)if(this.vm.vdom[e]===t)return this.vm.vdom.splice(e,1),
!0;return!1},o.prototype.up=function(t){for(var e=0,n=this.vm.vdom.length;n>e;e++)if(this.vm.vdom[e]===t){if(0===e)break;return this.vm.vdom.splice(e-1,2,this.vm.vdom[e],this.vm.vdom[e-1]),!0}return!1},o.prototype.down=function(t){for(var e=0,n=this.vm.vdom.length;n>e;e++)if(this.vm.vdom[e]===t){if(e===this.vm.vdom.length-1)break;return this.vm.vdom.splice(e,2,this.vm.vdom[e+1],this.vm.vdom[e]),!0}return!1},o.prototype.addVdom=function(){this.vm.addVdomByCurrentSelectedIndex()},o.prototype.addEmoji=function(t){this.vm.addEmoji(t).then(function(){location.reload()})},o.prototype.isShowMode=function(){return!1},o.prototype.isEditMode=function(){return!1},o.prototype.isNewMode=function(){return!1},o.prototype.load=function(){},o.prototype.save=function(){},e.exports=o},{"../../game/game":5,"../vm/common":74}],67:[function(t,e,n){"use strict";var r=t("mithril"),i=t("../../game/hakurei").util,o=t("../controller/base"),a=function(t,e){o.apply(this,arguments)};i.inherit(a,o),a.prototype.load=function(){var t=r.route.param("id");this.vm.loadFromAPI(t)},a.prototype.save=function(){if(!this.vm.isSaveLocked()){this.vm.saveLock();var t=this;this.vm.update().then(function(e){var n=window.document.querySelector("#snackbar"),r={message:"保存しました",timeout:1e3};n.MaterialSnackbar.showSnackbar(r),setTimeout(function(){t.vm.saveUnLock()},1e3)})}},a.prototype.isEditMode=function(){return!0},e.exports=a},{"../../game/hakurei":6,"../controller/base":66,mithril:75}],68:[function(t,e,n){"use strict";var r=t("../../game/hakurei").util,i=t("../controller/base"),o=function(t,e){i.apply(this,arguments)};r.inherit(o,i),o.prototype.load=function(){this.vm.loadFromDefault()},o.prototype.save=function(){if(!this.vm.isSaveLocked()){this.vm.saveLock();var t=this;this.vm.create().then(function(e){var n=window.document.querySelector("#snackbar"),r={message:"保存しました",timeout:1e3};n.MaterialSnackbar.showSnackbar(r),setTimeout(function(){t.vm.saveUnLock(),location.href="/novel/show/"+e.id},1e3)})}},o.prototype.isNewMode=function(){return!0},e.exports=o},{"../../game/hakurei":6,"../controller/base":66}],69:[function(t,e,n){"use strict";var r=t("mithril"),i=t("../../game/hakurei").util,o=t("../controller/base"),a=function(t,e){o.apply(this,arguments)};i.inherit(a,o),a.prototype.load=function(){var t=r.route.param("id");this.vm.loadFromAPI(t)},a.prototype.isShowMode=function(){return!0},e.exports=a},{"../../game/hakurei":6,"../controller/base":66,mithril:75}],70:[function(t,e,n){"use strict";var r=t("mithril"),i=t("../../game/config/bg"),o=[];for(var a in i){var s=i[a];o.push({name:s.name,value:a})}var u=function(t){this.value=r.prop(t.background||o[0].value)};u.prototype.define=function(){return"background"},u.prototype.toGameData=function(){return{define:this.define(),serif:"",background:this.value()}},u.prototype.toComponent=function(t){var e=this;return{tag:"span",children:[{tag:"b",children:["背景変更"]},{tag:"br"},{tag:"div",children:[{tag:"select",children:[function(){for(var t=[],n=0,r=o.length;r>n;n++){var i=o[n];t.push({tag:"option",children:[i.name],attrs:{value:i.value,selected:i.value===e.value()}})}return t}()],attrs:{className:"mdl-textfield__input",onchange:r.withAttr("value",function(n){e.value(n),t.reload()})}}],attrs:{className:"mdl-textfield mdl-js-textfield"}}]}},e.exports=u},{"../../game/config/bg":2,mithril:75}],71:[function(t,e,n){"use strict";var r=t("mithril"),i=t("../../game/config/bgm"),o=[];for(var a in i){var s=i[a];o.push({name:s.name,value:a})}var u=function(t){var e=t.option&&t.option.bgm?t.option.bgm:o[0].value;this.value=r.prop(e)};u.prototype.define=function(){return"bgm"},u.prototype.toGameData=function(){return{define:this.define(),serif:"",option:{bgm:this.value()}}},u.prototype.toComponent=function(t){var e=this;return{tag:"span",children:[{tag:"b",children:["BGM変更"]},{tag:"br"},{tag:"div",children:[{tag:"select",children:[function(){for(var t=[],n=0,r=o.length;r>n;n++){var i=o[n];t.push({tag:"option",children:[i.name],attrs:{value:i.value,selected:i.value===e.value()}})}return t}()],attrs:{className:"mdl-textfield__input",onchange:r.withAttr("value",function(n){e.value(n),t.reload()})}}],attrs:{className:"mdl-textfield mdl-js-textfield"}}]}},e.exports=u},{"../../game/config/bgm":3,mithril:75}],72:[function(t,e,n){"use strict";var r=t("mithril"),i=[{name:"蓮子",value:"renko"},{name:"メリー",value:"merry"}],o=[{name:"普通",value:"normal"},{name:"笑",value:"smile"},{name:"泣",value:"cry"},{name:"怒",value:"angry"},{name:"驚",value:"surprised"}],a=0,s=function(t){this.id=r.prop(++a),this.pos=r.prop(t.pos),this.exp=r.prop(t.exp||o[0].value),this.chara=r.prop(t.chara||i[0].value),"undefined"==typeof this.pos()&&("renko"===this.chara()?this.pos("right"):this.pos("left")),this.value=r.prop(t.serif||"")};s.prototype.define=function(){return"serif"},s.prototype.toGameData=function(){return{define:this.define(),pos:this.pos(),exp:this.exp(),chara:this.chara(),serif:this.value()}},s.prototype.toComponent=function(t){var e=this;return{tag:"span",children:[{tag:"b",children:["セリフ"]},{tag:"br"},{tag:"div",children:[{tag:"select",children:[function(){for(var t=[],n=0,r=i.length;r>n;n++){var o=i[n];t.push({tag:"option",children:[o.name],attrs:{value:o.value,selected:o.value===e.chara()}})}return t}()],attrs:{className:"mdl-textfield__input",onchange:r.withAttr("value",function(n){e.chara(n),"renko"===n?e.pos("right"):e.pos("left"),t.reload()})}}],attrs:{className:"mdl-textfield mdl-js-textfield"}},{tag:"br"},{tag:"div",children:[{tag:"select",children:[function(){for(var t=[],n=0,r=o.length;r>n;n++){var i=o[n];t.push({tag:"option",children:[i.name],attrs:{value:i.value,selected:i.value===e.exp()}})}return t}()],attrs:{className:"mdl-textfield__input",onchange:r.withAttr("value",function(n){e.exp(n),t.reload()})}}],attrs:{className:"mdl-textfield mdl-js-textfield"}},{tag:"br"},{tag:"div",children:[{tag:"textarea",attrs:{className:"mdl-textfield__input",rows:"3",id:e.id(),value:e.value(),onchange:r.withAttr("value",function(n){e.value(n),t.reload()})}},{tag:"label",children:["セリフ"],attrs:{className:"mdl-textfield__label","for":e.id()}}],attrs:{className:"mdl-textfield mdl-js-textfield",style:"display: block;width:100%;",config:function(t,e,n){e||(window.componentHandler.upgradeElement(t),n.onunload=function(){window.componentHandler.downgradeElements(t)})}}}]}},e.exports=s},{mithril:75}],73:[function(t,e,n){"use strict";var r=t("mithril"),i=t("../config/vdomlist");e.exports=function(t,e){var n=t.reload.bind(t),o=t.save.bind(t),a=t.togglePrivate.bind(t),s=t.runGame.bind(t);return{tag:"div",children:[{tag:"div",children:[{tag:"div",attrs:{className:"mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"}},{tag:"div",children:[{tag:"div",children:[{tag:"canvas",attrs:{width:"640",height:"480",config:s,style:"width: 100%; max-width: 640px;height: auto;"}},{tag:"div",children:[{tag:"hr"},{tag:"input",attrs:{type:"button",value:"リロード",onclick:n,className:"mdl-button mdl-js-button mdl-button--raised mdl-button--colored"}}],attrs:{style:{display:t.isNewMode()||t.isEditMode()?"block":"none"}}},{tag:"div",children:[{tag:"hr"},"タイトル:",t.vm.title(),{tag:"br"},"説明:",t.vm.description(),{tag:"br"},"投稿者:",{tag:"a",children:[t.vm.user().dispName()],attrs:{href:"/user/show/"+t.vm.user().id()}},{tag:"br"},{tag:"hr"},function(){for(var e=[],n=0,r=t.vm.emojis().length;r>n;n++){var i=t.vm.emojis()[n],o=function(e){return function(n){n.preventDefault(),t.addEmoji(e.type())}}(i);t.vm.isOwner()?e.push({tag:"span",children:[{tag:"img",attrs:{src:"/image/emoji/"+i.fileName(),width:"24",height:"24"}},{tag:"span",children:["　"+i.count()],attrs:{className:"mdl-chip__text",style:"font-size: 18px"}}],attrs:{className:"mdl-chip"}}):e.push({tag:"button",children:[{tag:"img",attrs:{src:"/image/emoji/"+i.fileName(),width:"24",height:"24"}},{tag:"span",children:["　"+i.count()],attrs:{className:"mdl-chip__text",style:"font-size: 18px"}}],attrs:{className:"mdl-chip",style:"cursor: pointer;",onclick:o}})}return e}()],attrs:{style:{display:t.isShowMode()?"block":"none"}}}],attrs:{className:"mdl-card__supporting-text mdl-color-text--black"}},{tag:"div",children:[{tag:"div",children:[{tag:"div",attrs:{className:"mdl-layout-spacer"}},{tag:"a",children:["編集 ",{tag:"i",children:["build"],attrs:{className:"material-icons"}}],attrs:{className:"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect",href:"/novel/edit/"+t.vm.id()}}],attrs:{className:"mdl-card__actions mdl-card--border"}}],attrs:{style:{display:t.isShowMode()&&t.vm.isOwner()?"block":"none"}}}],attrs:{className:"mdl-card mdl-cell mdl-cell--8-col mdl-shadow--2dp"}},{tag:"div",attrs:{className:"mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"}}],attrs:{className:"content-grid mdl-grid"}},{tag:"div",children:[{tag:"div",attrs:{className:"mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"}},{tag:"div",children:[{tag:"div",children:[{tag:"h1",children:["編集"],attrs:{className:"mdl-card__title-text"}}],attrs:{className:"mdl-card__title"}},{tag:"div",children:[{tag:"table",children:[{tag:"tbody",children:[function(){for(var e=[],n=0,r=t.vm.vdom.length;r>n;n++){var i=t.vm.vdom[n];!function(n){e.push({tag:"tr",children:[{tag:"td",children:[{tag:"button",children:[{tag:"i",children:["delete_forever"],attrs:{className:"material-icons"}}],attrs:{onclick:function(){t["delete"](n)&&t.reload()},className:"mdl-button mdl-js-button mdl-button--icon"}},{tag:"button",children:[{tag:"i",children:["keyboard_arrow_up"],attrs:{className:"material-icons"}}],attrs:{onclick:function(){t.up(n)&&t.reload()},className:"mdl-button mdl-js-button mdl-button--icon"}},{tag:"button",children:[{tag:"i",children:["keyboard_arrow_down"],attrs:{className:"material-icons"}}],attrs:{onclick:function(){t.down(n)&&t.reload()},className:"mdl-button mdl-js-button mdl-button--icon"}}],attrs:{className:"mdl-data-table__cell--non-numeric"}},{tag:"td",children:[n.toComponent(t)]}]})}(i)}return e}(),{tag:"tr",children:[{tag:"td",children:["スクリプト追加"],attrs:{className:"mdl-data-table__cell--non-numeric"}},{tag:"td",children:[{tag:"div",children:[{tag:"select",children:[function(){for(var e=[],n=0,r=i.length;r>n;n++){var o=i[n];e.push({tag:"option",children:[o.name],attrs:{value:o.value,selected:n===t.vm.currentAddVdomSelectedIndex()}})}return e}()],attrs:{className:"mdl-textfield__input",onchange:r.withAttr("selectedIndex",t.vm.currentAddVdomSelectedIndex)}}],attrs:{className:"mdl-textfield mdl-js-textfield"}},{tag:"button",children:[{tag:"i",children:["add"],attrs:{className:"material-icons"}}],attrs:{onclick:function(){t.addVdom(),t.reload()},className:"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored"}}]}]}]}],attrs:{className:"mdl-data-table mdl-js-data-table mdl-shadow--2dp"}}],attrs:{className:"mdl-card__supporting-text mdl-color-text--black"}},{tag:"div",children:[{tag:"div",children:[{tag:"input",attrs:{className:"mdl-textfield__input",type:"text",id:"title",value:t.vm.title(),onchange:r.withAttr("value",t.vm.title)}},{tag:"label",children:["タイトル"],attrs:{className:"mdl-textfield__label","for":"title"}}],attrs:{className:"mdl-textfield mdl-js-textfield mdl-textfield--floating-label"}},{tag:"br"},{tag:"div",children:[{tag:"textarea",attrs:{className:"mdl-textfield__input",type:"text",rows:"3",id:"description",value:t.vm.description(),onchange:r.withAttr("value",t.vm.description)}},{tag:"label",children:["紹介文"],attrs:{className:"mdl-textfield__label","for":"description"}}],attrs:{className:"mdl-textfield mdl-js-textfield  mdl-textfield--floating-label"}},{tag:"label",children:[{tag:"input",attrs:{type:"checkbox",id:"switch-1",className:"mdl-switch__input",onclick:a,checked:!t.vm.isPrivate()}},{tag:"span",children:[t.vm.isPrivate()?"非公開":"公開"],attrs:{className:"mdl-switch__label"}}],attrs:{className:"mdl-switch mdl-js-switch mdl-js-ripple-effect","for":"switch-1"}}],attrs:{className:"mdl-card__actions mdl-card--border"}},{tag:"div",children:[{tag:"div",attrs:{className:"mdl-layout-spacer"}},{tag:"input",attrs:{type:"button",value:"セーブ",onclick:o,className:"mdl-button mdl-js-button mdl-button--raised mdl-button--colored"}}],attrs:{className:"mdl-card__actions mdl-card--border"}}],attrs:{className:"mdl-card mdl-cell mdl-cell--8-col mdl-shadow--2dp"}},{tag:"div",attrs:{className:"mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"}}],attrs:{className:"content-grid mdl-grid",style:{display:t.isEditMode()||t.isNewMode()?"":"none"}}},{tag:"div",children:[{tag:"div",attrs:{className:"mdl-snackbar__text"}},{tag:"button",attrs:{className:"mdl-snackbar__action",type:"button"}}],attrs:{id:"snackbar",className:"mdl-js-snackbar mdl-snackbar",config:function(t,e,n){e||(window.componentHandler.upgradeElement(t),n.onunload=function(){window.componentHandler.downgradeElements(t)})}}}]}}},{"../config/vdomlist":65,mithril:75}],74:[function(t,e,n){"use strict";var r=t("mithril"),i=t("../config/vdomlist"),o='[{"define":"background","background":"nc4527"},{"define":"serif","pos":"right","exp":"normal","chara":"renko","serif":"あら奇遇ね\\n"},{"define":"serif","pos":"left","exp":"smile","chara":"merry","serif":"こちらこそ\\n蓮子は授業の帰りかしら"},{"define":"serif","pos":"right","exp":"normal","chara":"renko","serif":"まぁそんなところよ\\n"},{"define":"serif","pos":"right","exp":"smile","chara":"renko","serif":"このあとお茶でもいかがかしら？\\n"},{"define":"serif","pos":"left","exp":"smile","chara":"merry","serif":"あら、ぜひ\\n"}]',a=function(t){t=t||{},this.id=r.prop(t.ID),this.dispName=r.prop(t.DispName),this.fileName=r.prop(t.FileName)},s=function(t){t=t||{},this.fileName=r.prop(t.FileName),this.count=r.prop(t.Count),this.type=r.prop(t.Type)},u=function(t){this.id=r.prop(null),this.isPrivate=r.prop(!0),this.title=r.prop(""),this.description=r.prop(""),this.user=r.prop(new a),this.emojis=r.prop([]),this.isOwner=r.prop(!1),this.vdom=[],this.currentAddVdomSelectedIndex=r.prop(0),this._isSaveLocked=r.prop(!1),this._csrf_token=window.config.csrf};u.prototype.loadFromDefault=function(){var t=r.deferred();return this._string2vdom(o),t.resolve(),t.promise},u.prototype.loadFromAPI=function(t){var e="/api/v1/novel/show/"+t,n=this;return r.request({method:"GET",url:e}).then(function(t){n.id(t.Id),n.isPrivate(t.IsPrivate),n.title(t.Title),n.description(t.Description),n.user(new a(t.User)),n.isOwner(t.IsOwner);for(var e=[],r=0,i=t.Emojis.length;i>r;r++)e.push(new s(t.Emojis[r]));n.emojis(e),n._string2vdom(t.Script)})},u.prototype._string2vdom=function(t){for(var e=JSON.parse(t),n=0,r=e.length;r>n;n++)for(var o=e[n],a=0,s=i.length;s>a;a++){var u=i[a];if(u.value===o.define){this.vdom.push(new u.Klass(o));break}}},u.prototype._vdom2string=function(){return JSON.stringify(this.toGameData())},u.prototype.toGameData=function(){for(var t=[],e=0,n=this.vdom.length;n>e;e++){var r=this.vdom[e];t.push(r.toGameData())}return t},u.prototype.toPostData=function(){var t=this._vdom2string();return r.route.buildQueryString({script:t,title:this.title(),description:this.description(),isPrivate:this.isPrivate()?1:0})},u.prototype.addVdomByCurrentSelectedIndex=function(){var t=i[this.currentAddVdomSelectedIndex()];this.vdom.push(new t.Klass({type:t.value}))},u.prototype.create=function(){var t=this.toPostData(),e="/api/v1/novel/create",n=this._csrf_token;return r.request({method:"POST",url:e,data:t,serialize:function(t){return t},config:function(t){n&&(t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("X-CSRF-TOKEN",n))}})},u.prototype.update=function(){var t=this.toPostData(),e="/api/v1/novel/update/"+this.id(),n=this._csrf_token;return r.request({method:"POST",url:e,data:t,serialize:function(t){return t},config:function(t){n&&(t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("X-CSRF-TOKEN",n))}})},u.prototype.addEmoji=function(t){var e="/api/v1/novel/emoji/"+this.id()+"/add/"+t,n=this._csrf_token;return r.request({method:"POST",url:e,config:function(t){n&&(t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("X-CSRF-TOKEN",n))}})},u.prototype.togglePrivate=function(){this.isPrivate(!this.isPrivate())},u.prototype.isSaveLocked=function(){return this._isSaveLocked()},u.prototype.saveLock=function(){return this._isSaveLocked(!0)},u.prototype.saveUnLock=function(){return this._isSaveLocked(!1)},e.exports=u},{"../config/vdomlist":65,mithril:75}],75:[function(t,e,n){!function(t,n){"use strict";var r=n(t);"object"==typeof e&&null!=e&&e.exports?e.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):t.m=r}("undefined"!=typeof window?window:this,function(t,e){"use strict";function n(t){return"function"==typeof t}function r(t){return"[object Object]"===Ft.call(t)}function i(t){return"[object String]"===Ft.call(t)}function o(){}function a(t){wt=t.document,St=t.location,Dt=t.cancelAnimationFrame||t.clearTimeout,It=t.requestAnimationFrame||t.setTimeout}function s(t,e){for(var n,r=[],i=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g;n=i.exec(e);)if(""===n[1]&&n[2])t.tag=n[2];else if("#"===n[1])t.attrs.id=n[2];else if("."===n[1])r.push(n[2]);else if("["===n[3][0]){var o=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/.exec(n[3]);t.attrs[o[1]]=o[3]||""}return r}function u(t,e){var n=e?t.slice(1):t;return 1===n.length&&Tt(n[0])?n[0]:n}function l(t,e,n){var r="class"in e?"class":"className";for(var i in e)Et.call(e,i)&&(i===r&&null!=e[i]&&""!==e[i]?(n.push(e[i]),t[i]=""):t[i]=e[i]);n.length&&(t[r]=n.join(" "))}function c(t,e){for(var n=[],o=1,a=arguments.length;a>o;o++)n[o-1]=arguments[o];if(r(t))return rt(t,n);if(!i(t))throw new Error("selector in m(selector, attrs, children) should be a string");var c=null!=e&&r(e)&&!("tag"in e||"view"in e||"subtree"in e),h=c?e:{},d={tag:"div",attrs:{},children:u(n,c)};return l(d.attrs,h,s(d,t)),d}function h(t,e){for(var n=0;n<t.length&&!e(t[n],n++););}function d(t,e){h(t,function(t,n){return(t=t&&t.attrs)&&null!=t.key&&e(t,n)})}function p(t){try{if(null!=t&&null!=t.toString())return t}catch(e){}return""}function f(t,e,n,r){try{m(t,e,n),e.nodeValue=r}catch(i){}}function _(t){for(var e=0;e<t.length;e++)Tt(t[e])&&(t=t.concat.apply([],t),e--);return t}function m(t,e,n){t.insertBefore(e,t.childNodes[n]||null)}function g(t,e,n,r){d(t,function(t,r){e[t=t.key]=e[t]?{action:Pt,index:r,from:e[t].index,element:n.nodes[e[t].index]||wt.createElement("div")}:{action:kt,index:r}});var i=[];for(var o in e)Et.call(e,o)&&i.push(e[o]);var a=i.sort(G),s=new Array(n.length);return s.nodes=n.nodes.slice(),h(a,function(e){var i=e.index;if(e.action===Ct&&(X(n[i].nodes,n[i]),s.splice(i,1)),e.action===kt){var o=wt.createElement("div");o.key=t[i].attrs.key,m(r,o,i),s.splice(i,0,{attrs:{key:t[i].attrs.key},nodes:[o]}),s.nodes[i]=o}if(e.action===Pt){var a=e.element,u=r.childNodes[i];u!==a&&null!==a&&r.insertBefore(a,u||null),s[i]=n[e.from],s.nodes[i]=a}}),s}function v(t,e,n,r){var i=t.length!==e.length;return i||d(t,function(t,n){var r=e[n];return i=r&&r.attrs&&r.attrs.key!==t.key}),i?g(t,n,e,r):e}function y(t,e,n){h(t,function(t,r){null!=e[r]&&n.push.apply(n,e[r].nodes)}),h(e.nodes,function(t,r){null!=t.parentNode&&n.indexOf(t)<0&&X([t],[e[r]])}),t.length<e.length&&(e.length=t.length),e.nodes=n}function b(t){var e=0;d(t,function(){return h(t,function(t){(t=t&&t.attrs)&&null==t.key&&(t.key="__mithril__"+e++)}),1})}function x(t,e,n){return t.tag!==e.tag?!0:n.sort().join()!==Object.keys(e.attrs).sort().join()?!0:t.attrs.id!==e.attrs.id?!0:t.attrs.key!==e.attrs.key?!0:"all"===c.redraw.strategy()?!e.configContext||e.configContext.retain!==!0:"diff"===c.redraw.strategy()?e.configContext&&e.configContext.retain===!1:!1}function M(t,e,r){x(t,e,r)&&(e.nodes.length&&X(e.nodes),e.configContext&&n(e.configContext.onunload)&&e.configContext.onunload(),e.controllers&&h(e.controllers,function(t){t.onunload&&t.onunload({preventDefault:o})}))}function w(t,e){return t.attrs.xmlns?t.attrs.xmlns:"svg"===t.tag?"http://www.w3.org/2000/svg":"math"===t.tag?"http://www.w3.org/1998/Math/MathML":e}function S(t,e,n){n.length&&(t.views=e,t.controllers=n,h(n,function(t){if(t.onunload&&t.onunload.$old&&(t.onunload=t.onunload.$old),Rt&&t.onunload){var e=t.onunload;t.onunload=o,t.onunload.$old=e}}))}function I(t,e,r,i,o){if(n(e.attrs.config)){var a=o.configContext=o.configContext||{};t.push(function(){return e.attrs.config.call(e,r,!i,a,o)})}}function D(t,n,r,i,o,a,s,u){var l=t.nodes[0];return i&&H(l,n.tag,n.attrs,t.attrs,o),t.children=q(l,n.tag,e,e,n.children,t.children,!1,0,n.attrs.contenteditable?l:r,o,s),t.nodes.intact=!0,u.length&&(t.views=a,t.controllers=u),l}function E(t,e,n){var r;t.$trusted?r=Q(e,n,t):(r=[wt.createTextNode(t)],e.nodeName in At||m(e,r[0],n));var i;return i="string"==typeof t||"number"==typeof t||"boolean"==typeof t?new t.constructor(t):t,i.nodes=r,i}function F(t,e,n,r,i,o){var a=e.nodes;return r&&r===wt.activeElement||(t.$trusted?(X(a,e),a=Q(n,i,t)):"textarea"===o?n.value=t:r?r.innerHTML=t:((1===a[0].nodeType||a.length>1||a[0].nodeValue.trim&&!a[0].nodeValue.trim())&&(X(e.nodes,e),a=[wt.createTextNode(t)]),f(n,a[0],i,t))),e=new t.constructor(t),e.nodes=a,e}function T(t,e,n,r,i,o,a){return t.nodes.length?t.valueOf()!==e.valueOf()||i?F(e,t,r,o,n,a):(t.nodes.intact=!0,t):E(e,r,n)}function A(t){if(t.$trusted){var e=t.match(/<[^\/]|\>\s*[^<]/g);if(null!=e)return e.length}else if(Tt(t))return t.length;return 1}function C(t,n,r,i,o,a,s,u,l){t=_(t);var c=[],h=n.length===t.length,p=0,f={},m=!1;d(n,function(t,e){m=!0,f[n[e].attrs.key]={action:Ct,index:e}}),b(t),m&&(n=v(t,n,f,r));for(var g=0,x=0,M=t.length;M>x;x++){var w=q(r,o,n,i,t[x],n[g],a,i+p||p,s,u,l);w!==e&&(h=h&&w.nodes.intact,p+=A(w),n[g++]=w)}return h||y(t,n,c),n}function k(t,e,n,r,i){if(null!=e){if(Ft.call(e)===Ft.call(t))return e;if(i&&i.nodes){var o=n-r,a=o+(Tt(t)?t:e.nodes).length;X(i.nodes.slice(o,a),i.slice(o,a))}else e.nodes&&X(e.nodes,e)}return e=new t.constructor,e.tag&&(e={}),e.nodes=[],e}function P(t,e){return t.attrs.is?null==e?wt.createElement(t.tag,t.attrs.is):wt.createElementNS(e,t.tag,t.attrs.is):null==e?wt.createElement(t.tag):wt.createElementNS(e,t.tag)}function R(t,e,n,r){return r?H(e,t.tag,t.attrs,{},n):t.attrs}function N(t,n,r,i,o,a){return null!=t.children&&t.children.length>0?q(n,t.tag,e,e,t.children,r.children,!0,0,t.attrs.contenteditable?n:i,o,a):t.children}function j(t,e,n,r,i,o,a){var s={tag:t.tag,attrs:e,children:n,nodes:[r]};return S(s,o,a),s.children&&!s.children.nodes&&(s.children.nodes=[]),"select"===t.tag&&"value"in t.attrs&&H(r,t.tag,{value:t.attrs.value},{},i),s}function L(t,e,r,i){var o;return o="diff"===c.redraw.strategy()&&t?t.indexOf(e):-1,o>-1?r[o]:n(i)?new i:{}}function O(t,e,n,r){null!=r.onunload&&jt.map(function(t){return t.handler}).indexOf(r.onunload)<0&&jt.push({controller:r,handler:r.onunload}),t.push(n),e.push(r)}function B(t,e,n,r,i,o){var a=L(n.views,e,r,t.controller),s=t&&t.attrs&&t.attrs.key;return t=0===Rt||Lt||r&&r.indexOf(a)>-1?t.view(a):{tag:"placeholder"},"retain"===t.subtree?t:(t.attrs=t.attrs||{},t.attrs.key=s,O(o,i,e,a),t)}function z(t,e,n,r){for(var i=e&&e.controllers;null!=t.view;)t=B(t,t.view.$original||t.view,e,i,r,n);return t}function U(t,e,n,r,o,a,s,u){var l=[],c=[];if(t=z(t,e,l,c),"retain"===t.subtree)return e;if(!t.tag&&c.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");t.attrs=t.attrs||{},e.attrs=e.attrs||{};var h=Object.keys(t.attrs),d=h.length>("key"in t.attrs?1:0);if(M(t,e,h),i(t.tag)){var p=0===e.nodes.length;s=w(t,s);var f;if(p){f=P(t,s);var _=R(t,f,s,d);m(r,f,o);var g=N(t,f,e,n,s,u);e=j(t,_,g,f,s,l,c)}else f=D(e,t,n,d,s,l,u,c);return p||a!==!0||null==f||m(r,f,o),I(u,t,f,p,e),e}}function q(t,e,i,o,a,s,u,l,c,h,d){return a=p(a),"retain"===a.subtree?s:(s=k(a,s,l,o,i),Tt(a)?C(a,s,t,l,e,u,c,h,d):null!=a&&r(a)?U(a,s,c,t,l,u,h,d):n(a)?s:T(s,a,l,t,u,c,e))}function G(t,e){return t.action-e.action||t.index-e.index}function Y(t,e,n){for(var r in e)Et.call(e,r)&&(null==n||n[r]!==e[r])&&(t.style[r]=e[r]);for(r in n)Et.call(n,r)&&(Et.call(e,r)||(t.style[r]=""))}function W(t,e,i,o,a,s){if("config"===e||"key"===e)return!0;if(n(i)&&"on"===e.slice(0,2))t[e]=tt(i,t);else if("style"===e&&null!=i&&r(i))Y(t,i,o);else if(null!=s)"href"===e?t.setAttributeNS("http://www.w3.org/1999/xlink","href",i):t.setAttribute("className"===e?"class":e,i);else if(e in t&&!Ot[e])try{("input"!==a||t[e]!==i)&&(t[e]=i)}catch(u){t.setAttribute(e,i)}else t.setAttribute(e,i)}function V(t,e,n,r,i,o,a){if(e in i&&r===n&&wt.activeElement!==t)"value"===e&&"input"===o&&t.value!==n&&(t.value=n);else{i[e]=n;try{return W(t,e,n,r,o,a)}catch(s){if(s.message.indexOf("Invalid argument")<0)throw s}}}function H(t,e,n,r,i){for(var o in n)!Et.call(n,o)||!V(t,o,n[o],r[o],r,e,i);return r}function X(t,e){for(var n=t.length-1;n>-1;n--)if(t[n]&&t[n].parentNode){try{t[n].parentNode.removeChild(t[n])}catch(r){}e=[].concat(e),e[n]&&K(e[n])}t.length&&(t.length=0)}function K(t){t.configContext&&n(t.configContext.onunload)&&(t.configContext.onunload(),t.configContext.onunload=null),t.controllers&&h(t.controllers,function(t){n(t.onunload)&&t.onunload({preventDefault:o})}),t.children&&(Tt(t.children)?h(t.children,K):t.children.tag&&K(t.children))}function Z(t,e){try{t.appendChild(wt.createRange().createContextualFragment(e))}catch(n){t.insertAdjacentHTML("beforeend",e),J(t)}}function J(t){if("SCRIPT"===t.tagName)t.parentNode.replaceChild($(t),t);else{var e=t.childNodes;if(e&&e.length)for(var n=0;n<e.length;n++)J(e[n])}return t}function $(t){for(var e=document.createElement("script"),n=t.attributes,r=0;r<n.length;r++)e.setAttribute(n[r].name,n[r].value);return e.text=t.innerHTML,e}function Q(t,e,n){var r=t.childNodes[e];if(r){var i=1!==r.nodeType,o=wt.createElement("span");i?(t.insertBefore(o,r||null),o.insertAdjacentHTML("beforebegin",n),t.removeChild(o)):r.insertAdjacentHTML("beforebegin",n)}else Z(t,n);for(var a=[];t.childNodes[e]!==r;)a.push(t.childNodes[e]),e++;return a}function tt(t,e){return function(n){n=n||event,c.redraw.strategy("diff"),c.startComputation();try{return t.call(e,n)}finally{st()}}}function et(t){var e=zt.indexOf(t);return 0>e?zt.push(t)-1:e}function nt(t){function e(){return arguments.length&&(t=arguments[0]),t}return e.toJSON=function(){return t},e}function rt(t,e){function n(){return(t.controller||o).apply(this,e)||this}function r(n){for(var r=[n].concat(e),i=1;i<arguments.length;i++)r.push(arguments[i]);return t.view.apply(t,r)}t.controller&&(n.prototype=t.controller.prototype),r.$original=t.view;var i={controller:n,view:r};return e[0]&&null!=e[0].key&&(i.attrs={key:e[0].key}),i}function it(t,e,n,r){if(!r){c.redraw.strategy("all"),c.startComputation(),Gt[n]=e;var i;i=qt=t?t:t={controller:o};var a=new(t.controller||o);return i===qt&&(Wt[n]=a,Yt[n]=t),st(),null===t&&ot(e,n),Wt[n]}null==t&&ot(e,n)}function ot(t,e){Gt.splice(e,1),Wt.splice(e,1),Yt.splice(e,1),ft(t),zt.splice(et(t),1)}function at(){Xt&&(Xt(),Xt=null),h(Gt,function(t,e){var n=Yt[e];if(Wt[e]){var r=[Wt[e]];c.render(t,n.view?n.view(Wt[e],r):"")}}),Kt&&(Kt(),Kt=null),Vt=null,Ht=new Date,c.redraw.strategy("diff")}function st(){"none"===c.redraw.strategy()?(Rt--,c.redraw.strategy("diff")):c.endComputation()}function ut(t){return t.slice(te[c.route.mode].length)}function lt(t,e,n){$t={};var r=n.indexOf("?");-1!==r&&($t=pt(n.substr(r+1,n.length)),n=n.substr(0,r));var i=Object.keys(e),o=i.indexOf(n);if(-1!==o)return c.mount(t,e[i[o]]),!0;for(var a in e)if(Et.call(e,a)){if(a===n)return c.mount(t,e[a]),!0;var s=new RegExp("^"+a.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(s.test(n))return n.replace(s,function(){var n=a.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2);h(n,function(t,e){$t[t.replace(/:|\./g,"")]=decodeURIComponent(r[e])}),c.mount(t,e[a])}),!0}}function ct(t){if(t=t||event,!(t.ctrlKey||t.metaKey||t.shiftKey||2===t.which)){t.preventDefault?t.preventDefault():t.returnValue=!1;var e,n=t.currentTarget||t.srcElement;for(e="pathname"===c.route.mode&&n.search?pt(n.search.slice(1)):{};n&&!/a/i.test(n.nodeName);)n=n.parentNode;Rt=0,c.route(n[c.route.mode].slice(te[c.route.mode].length),e)}}function ht(){"hash"!==c.route.mode&&St.hash?St.hash=St.hash:t.scrollTo(0,0)}function dt(t,n){var i={},o=[];for(var a in t)if(Et.call(t,a)){var s=n?n+"["+a+"]":a,u=t[a];if(null===u)o.push(encodeURIComponent(s));else if(r(u))o.push(dt(u,s));else if(Tt(u)){var l=[];i[s]=i[s]||{},h(u,function(t){i[s][t]||(i[s][t]=!0,l.push(encodeURIComponent(s)+"="+encodeURIComponent(t)))}),o.push(l.join("&"))}else u!==e&&o.push(encodeURIComponent(s)+"="+encodeURIComponent(u))}return o.join("&")}function pt(t){if(""===t||null==t)return{};"?"===t.charAt(0)&&(t=t.slice(1));var e=t.split("&"),n={};return h(e,function(t){var e=t.split("="),r=decodeURIComponent(e[0]),i=2===e.length?decodeURIComponent(e[1]):null;null!=n[r]?(Tt(n[r])||(n[r]=[n[r]]),n[r].push(i)):n[r]=i}),n}function ft(t){var n=et(t);X(t.childNodes,Ut[n]),Ut[n]=e}function _t(t,e){var n=c.prop(e);return t.then(n),n.then=function(n,r){return _t(t.then(n,r),e)},n["catch"]=n.then.bind(null,null),n}function mt(t,e){function i(t){u=t||ae,h.map(function(t){u===oe?t.resolve(l):t.reject(l)})}function o(t,e,i,o){if((null!=l&&r(l)||n(l))&&n(t))try{var a=0;t.call(l,function(t){a++||(l=t,e())},function(t){a++||(l=t,i())})}catch(s){c.deferred.onerror(s),l=s,i()}else o()}function a(){var r;try{r=l&&l.then}catch(h){return c.deferred.onerror(h),l=h,u=ie,a()}u===ie&&c.deferred.onerror(l),o(r,function(){u=re,a()},function(){u=ie,a()},function(){try{u===re&&n(t)?l=t(l):u===ie&&n(e)&&(l=e(l),u=re)}catch(a){return c.deferred.onerror(a),l=a,i()}l===s?(l=TypeError(),i()):o(r,function(){i(oe)},i,function(){i(u===re&&oe)})})}var s=this,u=0,l=0,h=[];s.promise={},s.resolve=function(t){return u||(l=t,u=re,a()),s},s.reject=function(t){return u||(l=t,u=ie,a()),s},s.promise.then=function(t,e){var n=new mt(t,e);return u===oe?n.resolve(l):u===ae?n.reject(l):h.push(n),n.promise}}function gt(t){return t}function vt(n){var r=n.callbackName||"mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),i=wt.createElement("script");t[r]=function(o){i.parentNode.removeChild(i),n.onload({type:"load",target:{responseText:o}}),t[r]=e},i.onerror=function(){return i.parentNode.removeChild(i),n.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),t[r]=e,!1},i.onload=function(){return!1},i.src=n.url+(n.url.indexOf("?")>0?"&":"?")+(n.callbackKey?n.callbackKey:"callback")+"="+r+"&"+dt(n.data||{}),wt.body.appendChild(i)}function yt(e){var r=new t.XMLHttpRequest;if(r.open(e.method,e.url,!0,e.user,e.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?e.onload({type:"load",target:r}):e.onerror({type:"error",target:r}))},e.serialize===JSON.stringify&&e.data&&"GET"!==e.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.deserialize===JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),n(e.config)){var o=e.config(r,e);null!=o&&(r=o)}var a="GET"!==e.method&&e.data?e.data:"";if(a&&!i(a)&&a.constructor!==t.FormData)throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`");return r.send(a),r}function bt(t){return t.dataType&&"jsonp"===t.dataType.toLowerCase()?vt(t):yt(t)}function xt(t,e,n){if("GET"===t.method&&"jsonp"!==t.dataType){var r=t.url.indexOf("?")<0?"?":"&",i=dt(e);t.url+=i?r+i:""}else t.data=n(e)}function Mt(t,e){return e&&(t=t.replace(/:[a-z]\w+/gi,function(t){var n=t.slice(1),r=e[n]||t;return delete e[n],r})),t}c.version=function(){return"v0.2.5"};var wt,St,It,Dt,Et={}.hasOwnProperty,Ft={}.toString,Tt=Array.isArray||function(t){return"[object Array]"===Ft.call(t)},At={AREA:1,BASE:1,BR:1,COL:1,COMMAND:1,EMBED:1,HR:1,IMG:1,INPUT:1,KEYGEN:1,LINK:1,META:1,PARAM:1,SOURCE:1,TRACK:1,WBR:1};c.deps=function(e){return a(t=e||window),t},c.deps(t);var Ct=1,kt=2,Pt=3,Rt=0;c.startComputation=function(){Rt++},c.endComputation=function(){Rt>1?Rt--:(Rt=0,
c.redraw())};var Nt,jt=[],Lt=!1,Ot={list:1,style:1,form:1,type:1,width:1,height:1},Bt={appendChild:function(t){Nt===e&&(Nt=wt.createElement("html")),wt.documentElement&&wt.documentElement!==t?wt.replaceChild(t,wt.documentElement):wt.appendChild(t),this.childNodes=wt.childNodes},insertBefore:function(t){this.appendChild(t)},childNodes:[]},zt=[],Ut={};c.render=function(t,n,r){if(!t)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var i,o=[],a=et(t),s=t===wt;i=s||t===wt.documentElement?Bt:t,s&&"html"!==n.tag&&(n={tag:"html",attrs:{},children:n}),Ut[a]===e&&X(i.childNodes),r===!0&&ft(t),Ut[a]=q(i,null,e,e,n,Ut[a],!1,0,null,e,o),h(o,function(t){t()})},c.trust=function(t){return t=new String(t),t.$trusted=!0,t},c.prop=function(t){return(null!=t&&(r(t)||n(t))||"undefined"!=typeof Promise&&t instanceof Promise)&&n(t.then)?_t(t):nt(t)};var qt,Gt=[],Yt=[],Wt=[],Vt=null,Ht=0,Xt=null,Kt=null,Zt=16;c.component=function(t){for(var e=new Array(arguments.length-1),n=1;n<arguments.length;n++)e[n-1]=arguments[n];return rt(t,e)},c.mount=c.module=function(t,e){if(!t)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var r=Gt.indexOf(t);0>r&&(r=Gt.length);var i=!1,o={preventDefault:function(){i=!0,Xt=Kt=null}};return h(jt,function(t){t.handler.call(t.controller,o),t.controller.onunload=null}),i?h(jt,function(t){t.controller.onunload=t.handler}):jt=[],Wt[r]&&n(Wt[r].onunload)&&Wt[r].onunload(o),it(e,t,r,i)};var Jt=!1;c.redraw=function(e){if(!Jt){Jt=!0,e&&(Lt=!0);try{Vt&&!e?(It===t.requestAnimationFrame||new Date-Ht>Zt)&&(Vt>0&&Dt(Vt),Vt=It(at,Zt)):(at(),Vt=It(function(){Vt=null},Zt))}finally{Jt=Lt=!1}}},c.redraw.strategy=c.prop(),c.withAttr=function(t,e,n){return function(r){r=r||window.event;var i=r.currentTarget||this,o=n||this,a=t in i?i[t]:i.getAttribute(t);e.call(o,a)}};var $t,Qt,te={pathname:"",hash:"#",search:"?"},ee=o,ne=!1;c.route=function(e,n,r,o){if(0===arguments.length)return Qt;if(3===arguments.length&&i(n)){ee=function(t){var i=Qt=ut(t);if(!lt(e,r,i)){if(ne)throw new Error("Ensure the default route matches one of the routes defined in m.route");ne=!0,c.route(n,!0),ne=!1}};var a="hash"===c.route.mode?"onhashchange":"onpopstate";return t[a]=function(){var t=St[c.route.mode];"pathname"===c.route.mode&&(t+=St.search),Qt!==ut(t)&&ee(t)},Xt=ht,void t[a]()}if(e.addEventListener||e.attachEvent){var s="pathname"!==c.route.mode?St.pathname:"";return e.href=s+te[c.route.mode]+o.attrs.href,void(e.addEventListener?(e.removeEventListener("click",ct),e.addEventListener("click",ct)):(e.detachEvent("onclick",ct),e.attachEvent("onclick",ct)))}if(i(e)){var u=Qt;Qt=e;var l,h=n||{},d=Qt.indexOf("?");l=d>-1?pt(Qt.slice(d+1)):{};for(var p in h)Et.call(h,p)&&(l[p]=h[p]);var f,_=dt(l);f=d>-1?Qt.slice(0,d):Qt,_&&(Qt=f+(-1===f.indexOf("?")?"?":"&")+_);var m=(3===arguments.length?r:n)===!0||u===e;if(t.history.pushState){var g=m?"replaceState":"pushState";Xt=ht,Kt=function(){try{t.history[g](null,wt.title,te[c.route.mode]+Qt)}catch(e){St[c.route.mode]=Qt}},ee(te[c.route.mode]+Qt)}else St[c.route.mode]=Qt,ee(te[c.route.mode]+Qt)}},c.route.param=function(t){if(!$t)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return t?$t[t]:$t},c.route.mode="search",c.route.buildQueryString=dt,c.route.parseQueryString=pt,c.deferred=function(){var t=new mt;return t.promise=_t(t.promise),t};var re=1,ie=2,oe=3,ae=4;return c.deferred.onerror=function(t){if("[object Error]"===Ft.call(t)&&!/ Error/.test(t.constructor.toString()))throw Rt=0,t},c.sync=function(t){function e(t,e){return function(a){return i[t]=a,e||(o="reject"),0===--r&&(n.promise(i),n[o](i)),a}}var n=c.deferred(),r=t.length,i=[],o="resolve";return t.length>0?h(t,function(t,n){t.then(e(n,!0),e(n,!1))}):n.resolve([]),n.promise},c.request=function(t){t.background!==!0&&c.startComputation();var e,n,r,i=new mt,o=t.dataType&&"jsonp"===t.dataType.toLowerCase();return o?(e=t.serialize=n=t.deserialize=gt,r=function(t){return t.responseText}):(e=t.serialize=t.serialize||JSON.stringify,n=t.deserialize=t.deserialize||JSON.parse,r=t.extract||function(t){return t.responseText.length||n!==JSON.parse?t.responseText:null}),t.method=(t.method||"GET").toUpperCase(),t.url=Mt(t.url,t.data),xt(t,t.data,e),t.onload=t.onerror=function(e){try{e=e||event;var o=n(r(e.target,t));"load"===e.type?(t.unwrapSuccess&&(o=t.unwrapSuccess(o,e.target)),Tt(o)&&t.type?h(o,function(e,n){o[n]=new t.type(e)}):t.type&&(o=new t.type(o)),i.resolve(o)):(t.unwrapError&&(o=t.unwrapError(o,e.target)),i.reject(o))}catch(a){i.reject(a),c.deferred.onerror(a)}finally{t.background!==!0&&c.endComputation()}},bt(t),i.promise=_t(i.promise,t.initialValue),i.promise},c})},{}]},{},[61]);